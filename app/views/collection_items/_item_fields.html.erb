<li class="collection item picture blurb group">
  <div class="header module">
  <% item_name = collection_item.item_type == "Bookmark" ? 
            ts("Bookmark for %{title}", :title => collection_item.item.bookmarkable.title) : 
            (collection_item.item.title + (!collection_item.item.posted? ? ts("(draft)") : "")) %>

  <%= fields_for("collection_items[]", collection_item) do |form| %>
    <!--title-->
    <h4 class="heading" id="collection_item_<%= collection_item.id %>">
      <%= error_messages_for collection_item %>    
      <%= form.hidden_field :collection_id %>
      <%= link_to(item_name, collection_item.item) %>   
    </h4>

    <% unless @user %>
      <% # mod version %>
      <h5 class="heading" title="<%= ts('by') %>">
        <% collection_item.item_creator_pseuds.each do |pseud| %>
          <%= pseud.byline %>
            <% if collection_item.collection.user_is_posting_participant?(pseud.user) %>
              <%= ts("(Member)")%>
            <% end %>
          <% end %>
        <% # TODO: Make recipients and bylines links, separate recipients with space (currently "snow,astolat") %>
        <% unless collection_item.recipients.blank? %>
          <span class="recipients"><%= ts("for") %> <span class="user"><%= collection_item.recipients %></span></span>
        <% end %>
      </h5>

      <% else %>
        <% # user version %>
        <h5 class="heading">
          <%= ts("in") %> <span class="collection"><%= link_to collection_item.collection.title, collection_path(collection_item.collection) %></span>
          <% if collection_item.collection.user_is_posting_participant?(@user) %>
            <%= ts("(Member)") %>
          <% end %>
        </h5>
      <% end %>

      <p class="datetime" title="<%= ts('added') %>"><%= collection_item.item_date.to_date %></p>
      <div class="icon">
        <%= image_tag(collection_item.collection.icon.url(:standard), :size => "100x100", :alt => collection_item.collection.icon_alt_text, :class => "icon") %>
      </div> 
  </div>
   
  <% if collection_item.item %>
    <% # An item can be in multiple collections. Including the collection name in the id prevents multiple items from having the same id. %>
    <% id = "blurb_#{collection_item.item_type}_#{collection_item.item_id}_#{collection_item.collection.name}" %>
    <blockquote id="<%= id %>" class="<% if collection_item.item_type == 'Bookmark' %>bookmark <% else %>work <% end %> blurb toggled">
      <% if collection_item.item_type == 'Work' %>
        <%= render "works/work_module", :work => collection_item.item, :is_unrevealed => false %>
      <% elsif collection_item.item_type == 'Bookmark' %>     
        <% bookmark = collection_item.item %>
        <% bookmarkable = bookmark.bookmarkable %>
			  <%= render 'bookmarks/bookmark_item_module', :bookmarkable => bookmarkable %>
		    <%= render 'bookmarks/bookmark_user_module', :bookmark => bookmark %>
      <% end %>
    </blockquote>
  <% end %>
  
  <% # Tell the user if their work is revealed or anonymous instead of showing the buttons they cannot use...or we can show the buttons but checked and disabled. %>
  <% if @user %>
    <dl class="visibility stats">
      <dt><%= ts("Unrevealed:") %></dt>
      <dd>
        <% if collection_item.collection.unrevealed? %>
          <%= ts("Yes") %>
        <% else %>
          <%= ts("No") %>
        <% end %>
      </dd>
      <dt><%= ts("Anonymous:") %></dt>
      <dd>
        <% if collection_item.collection.anonymous? %>
          <%= ts("Yes") %>
        <% else %>
          <%= ts("No") %>
        <% end %>
      </dd>
    </dl>
  <% end %>

  <% # User should only be able to remove item from collection...unless user approval status does something I'm missing. %>
  <% # Why is this in the view when we have collection_item_controls partial? Only thing missing from partial is Details link %>
  <!--actions--> 
  <ul class="actions" role="menu">
    <% if collection_item.item %>
      <li>
        <% id = "blurb_#{collection_item.item_type}_#{collection_item.item_id}_#{collection_item.collection.name}" %>
        <%= link_to h(ts("Details")) + ' &#8595;'.html_safe, "#", :class => "#{id}_open" %>
        <%= link_to h(ts("Close Details")) + ' &#8593;'.html_safe, "#", :class => "#{id}_close" %>
      </li>
    <% end %>
    <li class="status action">
      <% if @user %>
        <%= form.select(:user_approval_status, CollectionItem::APPROVAL_OPTIONS) %>
      <% else %>
        <%= form.select(:collection_approval_status, CollectionItem::APPROVAL_OPTIONS) %>
      <% end %>
    </li>

    <% # Shows for both mods and users but recommend changing because users cannot change revealed or anon status %>
    <% id = "collection_items_" %>
    <% if collection_item.collection.unrevealed? %>
      <li>
        <label for="collection_items_<%= collection_item.id %>_unrevealed">
          <%= ts("Unrevealed") %>
          <%= form.check_box :unrevealed %>
        </label>
      </li>
    <% end %>
    <% if collection_item.collection.anonymous? %>
      <li>
        <label for="collection_items_<%= collection_item.id %>_anonymous">
          <%= ts("Anonymous") %>
          <%= form.check_box :anonymous %>
        </label>
      </li>
    <% end %>        
    <li>
      <label for="collection_items_<%= collection_item.id %>_remove">
        <%= ts("Remove") %>
        <%= form.check_box :remove %>
      </label>
    </li>
  </ul>
</li>
<% end %>
