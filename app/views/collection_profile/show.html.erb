<div class="collection profile module">
  <%= render :partial => 'collections/header', :locals => {:collection => @collection} %>

<div class="collection module">
  <h3><%=h t('about', :default => "About {{name}}", :name => sanitize_title_for_display(@collection.title) +  ((@collection.title != @collection.name) ? " (#{@collection.name})" : "")) %></h3>
  <p class="datetime"><%= t('active_since', :default => "Active since: {{date}}", :date => l(@collection.created_at.to_date)) %></p>
  <div class="wrapper">
    <dl class="collection meta">
      <dt><%=h t('collections.owners', :default => "Maintainers:") %></dt>
      <dd>
        <ul>
          <%= (@collection.all_owners + @collection.all_moderators).map {|owner| "<li>#{link_to(owner.byline, owner.user)}</li>"}.join(', ') -%>
        </ul>
        <%- unless @collection.email.blank? -%>
          <h5>
            <%=h t('collection.email', :default => "Contact: ") %>
            <%=h @collection.email %>
          </h5>
        <% end -%>
      </dd>

      <% if @collection.challenge %>
      <!-- challenge information -->
        <%= render :partial => "challenge/#{challenge_class_name(@collection)}/challenge_meta" %>
      <!-- end challenge subsection -->
      <% end %>
    </dl>
  </div>
</div>

<%- cache("collection-profile-#{@collection.id}", :expires_in => AdminSetting.cache_expiration.minutes ) do -%> 

<!--main content-->
<hr class="clear"/><!-- FRONT END this is here temporarily until the right fix can be put in -->

<% if show_collection_preface(@collection) %>
  <div class="collection preface">
    <% if show_collection_section(@collection, "intro") %>
    <div id="intro" class="module">
      <%= render :partial => 'navigation', :locals => {:section => 'intro'} -%>
      <h3><%=h t('intro', :default => "Intro:") %></h3>
      <blockquote class="user-generated-view"><%= sanitize_and_format_for_display(@collection.collection_profile.intro.blank? ? @collection.parent.collection_profile.intro : @collection.collection_profile.intro) %></blockquote>
    </div>
    <% end -%>

    <%- if show_collection_section(@collection, "faq") -%>
    <div id="faq" class="module">
      <%= render :partial => 'navigation', :locals => {:section => 'faq'} -%>
      <h3><%=h t('faq', :default => "FAQ:") %></h3>
      <blockquote class="user-generated-view"><%= sanitize_and_format_for_display(@collection.collection_profile.faq.blank? ? @collection.parent.collection_profile.faq : @collection.collection_profile.faq) %></blockquote>
    </div>
    <%- end -%>

    <% if show_collection_section(@collection, "rules") %>
      <div id="rules" class="module">
        <%= render :partial => 'navigation', :locals => {:section => 'rules'} -%>
        <h3><%=h t('rules', :default => "Rules:") %></h3>
        <blockquote class="user-generated-view"><%= sanitize_and_format_for_display(@collection.collection_profile.rules.blank? ? @collection.parent.collection_profile.rules : @collection.collection_profile.rules) %></blockquote>
      </div>
    <%- end -%>
  </div>
<%- end -%>

<%- end # of cached bottom -%>
  
<%- if @collection.user_is_owner?(current_user) || @collection.user_is_maintainer?(current_user) -%>
  <h3 class="landmark">Actions</h3>
  <ul class="navigation" role="navigation">

  	<% if @collection.challenge # add maintainer-specific custom navigation for the challenge %>
  	  <%= render :partial => "challenge/#{challenge_class_name(@collection)}/challenge_navigation_maintainer" -%>
  	<% end %>

    <% if @collection.user_is_owner?(current_user) %>
  	  <li><%= link_to t('collections.settings', :default => "Settings"), edit_collection_path(@collection) %></li>
  	  <li><%= link_to t('collections.delete', :default => "Delete"), collection_path(@collection), 
        :confirm => t('collection_confirm_delete', :default => 'Are you certain you want to delete this collection? All collection settings will be lost. (Works will not be deleted.)'),
        :method => :delete %></li>
      <% if @collection.challenge %>
        <li><%= link_to t('collections.challenge_delete', 
          :default => "Delete Challenge"), eval("collection_#{challenge_class_name(@collection)}_path(@collection)"), 
          :confirm => t('collection_confirm_challenge_delete', :default => 'Are you certain you want to delete the challenge from this collection? All signups, assignments, and settings will be lost. (Works will remain in the collection.)'),
          :method => :delete %></li>
      <% end %>
    <% end %>
  </ul>
  <%- end -%>
  
</div>
