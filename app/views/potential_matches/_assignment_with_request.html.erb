<!-- expects local "assignment" -->
<% fields_for "challenge_assignments[]", assignment do |assignment_form| %>
  <% request_signup = assignment.request_signup %>
  <tr>
    <td>
      <%= assignment_form.hidden_field :collection_id, :value => @collection.id %>
      <%= assignment_form.hidden_field :request_signup_id, :value => request_signup.id %>
      <%= request_signup.pseud.byline -%>
    </td>
    <td>
      <%= request_signup.offer_assignments.map { |offer_assignment| 
        offer_assignment.request_signup ?
          "#{offer_assignment.request_signup.pseud.byline}" :
          (offer_assignment.pinch_request_signup ?
            "#{offer_assignment.pinch_request_signup.pseud.byline}* 
             (pinch recipient)" : 
             "<strong>None</strong> (see above)")}.join(", ") 
      -%>
    </td>  
    <td>
      <% if !(@pmatches = request_signup.request_potential_matches).empty? %>
        <% @pmatches = @pmatches.sort.reverse %>
        <%= assignment_form.collection_select :offer_signup_id, @pmatches.collect(&:offer_signup), :id, :byline, 
                                              :include_blank => "- None Assigned -" -%>

        <h4>Potential Giver Details:</h4>
        <h5 id="show_potentials_for_<%= request_signup.id -%>" 
            onclick="$('potentials_for_<%= request_signup.id -%>').show(); $('hide_potentials_for_<%= request_signup.id -%>').show(); this.hide();">(Show...)</h5>
        <h5 style="display: none" id="hide_potentials_for_<%= request_signup.id -%>" 
            onclick="$('potentials_for_<%= request_signup.id -%>').hide(); $('show_potentials_for_<%= request_signup.id -%>').show(); this.hide();">(Hide...)</h5>
        <div id="potentials_for_<%= request_signup.id -%>" class="hideme">
          <%= @pmatches.map {|pm| link_to(pm.offer_signup.byline, collection_potential_match_path(@collection, pm))}.join(", ") -%>
        </div>
      <% else %>
        <strong>No potential matches.</strong>
      <% end %>
    </td>
    <td>
      <%= assignment_form.text_field :pinch_hitter_byline %>
      <%= autocomplete_text_field("challenge_assignments_#{assignment.id}_pinch_hitter_byline", :methodname => "pseud_byline", :no_comma => true) -%>
    </td>
    <td>
      <%= manage_challenge_signup_links(request_signup) %>
    </td>
  </tr>
<% end %>
