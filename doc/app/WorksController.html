<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: WorksController</title>

	<link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

	<script src="./js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="./app/controllers/works_controller_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="app/controllers/works_controller.rb">app/controllers/works_controller.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link"><a href="ApplicationController.html">ApplicationController</a></p>
				
			</div>
			

			<!-- Namespace Contents -->
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-i-cancel_posting_and_redirect">#cancel_posting_and_redirect</a></li>
					
					<li><a href="#method-i-confirm_delete">#confirm_delete</a></li>
					
					<li><a href="#method-i-create">#create</a></li>
					
					<li><a href="#method-i-destroy">#destroy</a></li>
					
					<li><a href="#method-i-drafts">#drafts</a></li>
					
					<li><a href="#method-i-edit">#edit</a></li>
					
					<li><a href="#method-i-edit_multiple">#edit_multiple</a></li>
					
					<li><a href="#method-i-edit_tags">#edit_tags</a></li>
					
					<li><a href="#method-i-import">#import</a></li>
					
					<li><a href="#method-i-import_multiple">#import_multiple</a></li>
					
					<li><a href="#method-i-import_single">#import_single</a></li>
					
					<li><a href="#method-i-index">#index</a></li>
					
					<li><a href="#method-i-load_pseuds">#load_pseuds</a></li>
					
					<li><a href="#method-i-load_work">#load_work</a></li>
					
					<li><a href="#method-i-marktoread">#marktoread</a></li>
					
					<li><a href="#method-i-navigate">#navigate</a></li>
					
					<li><a href="#method-i-new">#new</a></li>
					
					<li><a href="#method-i-post_draft">#post_draft</a></li>
					
					<li><a href="#method-i-preview">#preview</a></li>
					
					<li><a href="#method-i-preview_tags">#preview_tags</a></li>
					
					<li><a href="#method-i-search">#search</a></li>
					
					<li><a href="#method-i-send_external_invites">#send_external_invites</a></li>
					
					<li><a href="#method-i-set_author_attributes">#set_author_attributes</a></li>
					
					<li><a href="#method-i-set_instance_variables">#set_instance_variables</a></li>
					
					<li><a href="#method-i-set_instance_variables_tags">#set_instance_variables_tags</a></li>
					
					<li><a href="#method-i-show">#show</a></li>
					
					<li><a href="#method-i-show_multiple">#show_multiple</a></li>
					
					<li><a href="#method-i-tag_list">#tag_list</a></li>
					
					<li><a href="#method-i-update">#update</a></li>
					
					<li><a href="#method-i-update_multiple">#update_multiple</a></li>
					
					<li><a href="#method-i-update_tags">#update_tags</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
					<li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="./images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="./Static.html">Static</a></li>
				
					<li><a href="./Static/BaseController.html">Static::BaseController</a></li>
				
					<li><a href="./Static/CollectionsController.html">Static::CollectionsController</a></li>
				
					<li><a href="./Static/FandomsController.html">Static::FandomsController</a></li>
				
					<li><a href="./Static/MediaController.html">Static::MediaController</a></li>
				
					<li><a href="./Static/RestrictedWorksController.html">Static::RestrictedWorksController</a></li>
				
					<li><a href="./Static/WorksController.html">Static::WorksController</a></li>
				
					<li><a href="./Admin.html">Admin</a></li>
				
					<li><a href="./Admin/AdminInvitationsController.html">Admin::AdminInvitationsController</a></li>
				
					<li><a href="./Admin/AdminUsersController.html">Admin::AdminUsersController</a></li>
				
					<li><a href="./Admin/SettingsController.html">Admin::SettingsController</a></li>
				
					<li><a href="./Admin/SkinsController.html">Admin::SkinsController</a></li>
				
					<li><a href="./Admin/UserCreationsController.html">Admin::UserCreationsController</a></li>
				
					<li><a href="./ActionController.html">ActionController</a></li>
				
					<li><a href="./ActionController/Routing.html">ActionController::Routing</a></li>
				
					<li><a href="./ActionController/Routing/RouteSet.html">ActionController::Routing::RouteSet</a></li>
				
					<li><a href="./Challenge.html">Challenge</a></li>
				
					<li><a href="./Challenge/GiftExchangeController.html">Challenge::GiftExchangeController</a></li>
				
					<li><a href="./Challenge/PromptMemeController.html">Challenge::PromptMemeController</a></li>
				
					<li><a href="./ActiveRecord.html">ActiveRecord</a></li>
				
					<li><a href="./AutocompleteSource.html">AutocompleteSource</a></li>
				
					<li><a href="./AutocompleteSource/ClassMethods.html">AutocompleteSource::ClassMethods</a></li>
				
					<li><a href="./ChallengeCore.html">ChallengeCore</a></li>
				
					<li><a href="./ChallengeCore/ClassMethods.html">ChallengeCore::ClassMethods</a></li>
				
					<li><a href="./StoryParser.html">StoryParser</a></li>
				
					<li><a href="./StoryParser/Error.html">StoryParser::Error</a></li>
				
					<li><a href="./XhtmlSplitter.html">XhtmlSplitter</a></li>
				
					<li><a href="./XhtmlSplitter/Error.html">XhtmlSplitter::Error</a></li>
				
					<li><a href="./AbuseReport.html">AbuseReport</a></li>
				
					<li><a href="./AbuseReportsController.html">AbuseReportsController</a></li>
				
					<li><a href="./AdminMailer.html">AdminMailer</a></li>
				
					<li><a href="./AdminPost.html">AdminPost</a></li>
				
					<li><a href="./AdminPostTag.html">AdminPostTag</a></li>
				
					<li><a href="./AdminPostTagging.html">AdminPostTagging</a></li>
				
					<li><a href="./AdminPostsController.html">AdminPostsController</a></li>
				
					<li><a href="./AdminSession.html">AdminSession</a></li>
				
					<li><a href="./AdminSessionsController.html">AdminSessionsController</a></li>
				
					<li><a href="./AdminSetting.html">AdminSetting</a></li>
				
					<li><a href="./AdminsController.html">AdminsController</a></li>
				
					<li><a href="./AdvancedSearchHelper.html">AdvancedSearchHelper</a></li>
				
					<li><a href="./AlphabetHelper.html">AlphabetHelper</a></li>
				
					<li><a href="./ApplicationController.html">ApplicationController</a></li>
				
					<li><a href="./ApplicationHelper.html">ApplicationHelper</a></li>
				
					<li><a href="./ArchiveFaq.html">ArchiveFaq</a></li>
				
					<li><a href="./ArchiveFaqsController.html">ArchiveFaqsController</a></li>
				
					<li><a href="./AuthlogicHelpersForMailers.html">AuthlogicHelpersForMailers</a></li>
				
					<li><a href="./AutocompleteController.html">AutocompleteController</a></li>
				
					<li><a href="./Banned.html">Banned</a></li>
				
					<li><a href="./Bookmark.html">Bookmark</a></li>
				
					<li><a href="./BookmarksController.html">BookmarksController</a></li>
				
					<li><a href="./BookmarksHelper.html">BookmarksHelper</a></li>
				
					<li><a href="./CacheHelper.html">CacheHelper</a></li>
				
					<li><a href="./CastNomination.html">CastNomination</a></li>
				
					<li><a href="./Category.html">Category</a></li>
				
					<li><a href="./ChallengeAssignment.html">ChallengeAssignment</a></li>
				
					<li><a href="./ChallengeAssignmentsController.html">ChallengeAssignmentsController</a></li>
				
					<li><a href="./ChallengeClaim.html">ChallengeClaim</a></li>
				
					<li><a href="./ChallengeClaimsController.html">ChallengeClaimsController</a></li>
				
					<li><a href="./ChallengeHelper.html">ChallengeHelper</a></li>
				
					<li><a href="./ChallengeRequestsController.html">ChallengeRequestsController</a></li>
				
					<li><a href="./ChallengeSignup.html">ChallengeSignup</a></li>
				
					<li><a href="./ChallengeSignupObserver.html">ChallengeSignupObserver</a></li>
				
					<li><a href="./ChallengeSignupSweeper.html">ChallengeSignupSweeper</a></li>
				
					<li><a href="./ChallengeSignupsController.html">ChallengeSignupsController</a></li>
				
					<li><a href="./ChallengeSweeper.html">ChallengeSweeper</a></li>
				
					<li><a href="./ChallengesController.html">ChallengesController</a></li>
				
					<li><a href="./Chapter.html">Chapter</a></li>
				
					<li><a href="./ChapterSweeper.html">ChapterSweeper</a></li>
				
					<li><a href="./ChaptersController.html">ChaptersController</a></li>
				
					<li><a href="./ChaptersHelper.html">ChaptersHelper</a></li>
				
					<li><a href="./Character.html">Character</a></li>
				
					<li><a href="./CharacterNomination.html">CharacterNomination</a></li>
				
					<li><a href="./Collectible.html">Collectible</a></li>
				
					<li><a href="./Collection.html">Collection</a></li>
				
					<li><a href="./CollectionItem.html">CollectionItem</a></li>
				
					<li><a href="./CollectionItemsController.html">CollectionItemsController</a></li>
				
					<li><a href="./CollectionObserver.html">CollectionObserver</a></li>
				
					<li><a href="./CollectionParticipant.html">CollectionParticipant</a></li>
				
					<li><a href="./CollectionParticipantsController.html">CollectionParticipantsController</a></li>
				
					<li><a href="./CollectionPreference.html">CollectionPreference</a></li>
				
					<li><a href="./CollectionProfile.html">CollectionProfile</a></li>
				
					<li><a href="./CollectionProfileController.html">CollectionProfileController</a></li>
				
					<li><a href="./CollectionSweeper.html">CollectionSweeper</a></li>
				
					<li><a href="./CollectionsController.html">CollectionsController</a></li>
				
					<li><a href="./CollectionsHelper.html">CollectionsHelper</a></li>
				
					<li><a href="./Comment.html">Comment</a></li>
				
					<li><a href="./CommentMailer.html">CommentMailer</a></li>
				
					<li><a href="./CommentObserver.html">CommentObserver</a></li>
				
					<li><a href="./CommentSweeper.html">CommentSweeper</a></li>
				
					<li><a href="./CommentsController.html">CommentsController</a></li>
				
					<li><a href="./CommentsHelper.html">CommentsHelper</a></li>
				
					<li><a href="./CommonTagging.html">CommonTagging</a></li>
				
					<li><a href="./CreationObserver.html">CreationObserver</a></li>
				
					<li><a href="./Creatorship.html">Creatorship</a></li>
				
					<li><a href="./CssCleaner.html">CssCleaner</a></li>
				
					<li><a href="./DateHelper.html">DateHelper</a></li>
				
					<li><a href="./DevmodeController.html">DevmodeController</a></li>
				
					<li><a href="./DownloadsController.html">DownloadsController</a></li>
				
					<li><a href="./EmailVeracityValidator.html">EmailVeracityValidator</a></li>
				
					<li><a href="./ErrorsController.html">ErrorsController</a></li>
				
					<li><a href="./ExternalAuthor.html">ExternalAuthor</a></li>
				
					<li><a href="./ExternalAuthorName.html">ExternalAuthorName</a></li>
				
					<li><a href="./ExternalAuthorsController.html">ExternalAuthorsController</a></li>
				
					<li><a href="./ExternalAuthorsHelper.html">ExternalAuthorsHelper</a></li>
				
					<li><a href="./ExternalCreatorship.html">ExternalCreatorship</a></li>
				
					<li><a href="./ExternalWork.html">ExternalWork</a></li>
				
					<li><a href="./ExternalWorksController.html">ExternalWorksController</a></li>
				
					<li><a href="./Fandom.html">Fandom</a></li>
				
					<li><a href="./FandomNomination.html">FandomNomination</a></li>
				
					<li><a href="./FandomsController.html">FandomsController</a></li>
				
					<li><a href="./FeedSweeper.html">FeedSweeper</a></li>
				
					<li><a href="./Feedback.html">Feedback</a></li>
				
					<li><a href="./FeedbacksController.html">FeedbacksController</a></li>
				
					<li><a href="./FilterCount.html">FilterCount</a></li>
				
					<li><a href="./FilterTagging.html">FilterTagging</a></li>
				
					<li><a href="./FindRandom.html">FindRandom</a></li>
				
					<li><a href="./Freeform.html">Freeform</a></li>
				
					<li><a href="./FreeformNomination.html">FreeformNomination</a></li>
				
					<li><a href="./Gift.html">Gift</a></li>
				
					<li><a href="./GiftExchange.html">GiftExchange</a></li>
				
					<li><a href="./GiftsController.html">GiftsController</a></li>
				
					<li><a href="./HitCounter.html">HitCounter</a></li>
				
					<li><a href="./HomeController.html">HomeController</a></li>
				
					<li><a href="./HomeHelper.html">HomeHelper</a></li>
				
					<li><a href="./HtmlCleaner.html">HtmlCleaner</a></li>
				
					<li><a href="./InboxComment.html">InboxComment</a></li>
				
					<li><a href="./InboxController.html">InboxController</a></li>
				
					<li><a href="./InboxHelper.html">InboxHelper</a></li>
				
					<li><a href="./Invitation.html">Invitation</a></li>
				
					<li><a href="./InvitationsController.html">InvitationsController</a></li>
				
					<li><a href="./InvitationsHelper.html">InvitationsHelper</a></li>
				
					<li><a href="./InviteRequest.html">InviteRequest</a></li>
				
					<li><a href="./InviteRequestsController.html">InviteRequestsController</a></li>
				
					<li><a href="./KnownIssue.html">KnownIssue</a></li>
				
					<li><a href="./KnownIssuesController.html">KnownIssuesController</a></li>
				
					<li><a href="./Kudo.html">Kudo</a></li>
				
					<li><a href="./KudoMailer.html">KudoMailer</a></li>
				
					<li><a href="./KudoObserver.html">KudoObserver</a></li>
				
					<li><a href="./KudosController.html">KudosController</a></li>
				
					<li><a href="./Language.html">Language</a></li>
				
					<li><a href="./LanguagesController.html">LanguagesController</a></li>
				
					<li><a href="./Locale.html">Locale</a></li>
				
					<li><a href="./LocalesController.html">LocalesController</a></li>
				
					<li><a href="./LogItem.html">LogItem</a></li>
				
					<li><a href="./Media.html">Media</a></li>
				
					<li><a href="./MediaController.html">MediaController</a></li>
				
					<li><a href="./MetaTagging.html">MetaTagging</a></li>
				
					<li><a href="./Offer.html">Offer</a></li>
				
					<li><a href="./OrphansController.html">OrphansController</a></li>
				
					<li><a href="./OrphansHelper.html">OrphansHelper</a></li>
				
					<li><a href="./OwnedSetTagging.html">OwnedSetTagging</a></li>
				
					<li><a href="./OwnedTagSet.html">OwnedTagSet</a></li>
				
					<li><a href="./OwnedTagSetsController.html">OwnedTagSetsController</a></li>
				
					<li><a href="./PaginationListLinkRenderer.html">PaginationListLinkRenderer</a></li>
				
					<li><a href="./PasswordsController.html">PasswordsController</a></li>
				
					<li><a href="./People.html">People</a></li>
				
					<li><a href="./PeopleController.html">PeopleController</a></li>
				
					<li><a href="./PotentialMatch.html">PotentialMatch</a></li>
				
					<li><a href="./PotentialMatchSettings.html">PotentialMatchSettings</a></li>
				
					<li><a href="./PotentialMatchesController.html">PotentialMatchesController</a></li>
				
					<li><a href="./PotentialPromptMatch.html">PotentialPromptMatch</a></li>
				
					<li><a href="./Preference.html">Preference</a></li>
				
					<li><a href="./PreferencesController.html">PreferencesController</a></li>
				
					<li><a href="./Profile.html">Profile</a></li>
				
					<li><a href="./ProfileController.html">ProfileController</a></li>
				
					<li><a href="./Prompt.html">Prompt</a></li>
				
					<li><a href="./PromptMeme.html">PromptMeme</a></li>
				
					<li><a href="./PromptRestriction.html">PromptRestriction</a></li>
				
					<li><a href="./PromptRestrictionsHelper.html">PromptRestrictionsHelper</a></li>
				
					<li><a href="./PromptsController.html">PromptsController</a></li>
				
					<li><a href="./Pseud.html">Pseud</a></li>
				
					<li><a href="./PseudSweeper.html">PseudSweeper</a></li>
				
					<li><a href="./PseudsController.html">PseudsController</a></li>
				
					<li><a href="./PseudsHelper.html">PseudsHelper</a></li>
				
					<li><a href="./Query.html">Query</a></li>
				
					<li><a href="./Rating.html">Rating</a></li>
				
					<li><a href="./Rawk.html">Rawk</a></li>
				
					<li><a href="./Reading.html">Reading</a></li>
				
					<li><a href="./ReadingsController.html">ReadingsController</a></li>
				
					<li><a href="./RedirectController.html">RedirectController</a></li>
				
					<li><a href="./RedisTestSetup.html">RedisTestSetup</a></li>
				
					<li><a href="./RelatedWork.html">RelatedWork</a></li>
				
					<li><a href="./RelatedWorksController.html">RelatedWorksController</a></li>
				
					<li><a href="./Relationship.html">Relationship</a></li>
				
					<li><a href="./RelationshipNomination.html">RelationshipNomination</a></li>
				
					<li><a href="./Request.html">Request</a></li>
				
					<li><a href="./Role.html">Role</a></li>
				
					<li><a href="./RolesUser.html">RolesUser</a></li>
				
					<li><a href="./SearchController.html">SearchController</a></li>
				
					<li><a href="./SearchHelper.html">SearchHelper</a></li>
				
					<li><a href="./SerialWork.html">SerialWork</a></li>
				
					<li><a href="./SerialWorksController.html">SerialWorksController</a></li>
				
					<li><a href="./Series.html">Series</a></li>
				
					<li><a href="./SeriesController.html">SeriesController</a></li>
				
					<li><a href="./SeriesHelper.html">SeriesHelper</a></li>
				
					<li><a href="./SetTagging.html">SetTagging</a></li>
				
					<li><a href="./Skin.html">Skin</a></li>
				
					<li><a href="./SkinParent.html">SkinParent</a></li>
				
					<li><a href="./SkinsController.html">SkinsController</a></li>
				
					<li><a href="./SkinsHelper.html">SkinsHelper</a></li>
				
					<li><a href="./SortableList.html">SortableList</a></li>
				
					<li><a href="./Stat.html">Stat</a></li>
				
					<li><a href="./StatHash.html">StatHash</a></li>
				
					<li><a href="./StaticSweeper.html">StaticSweeper</a></li>
				
					<li><a href="./StatsController.html">StatsController</a></li>
				
					<li><a href="./StatsHelper.html">StatsHelper</a></li>
				
					<li><a href="./Subscription.html">Subscription</a></li>
				
					<li><a href="./SubscriptionsController.html">SubscriptionsController</a></li>
				
					<li><a href="./Tag.html">Tag</a></li>
				
					<li><a href="./TagNomination.html">TagNomination</a></li>
				
					<li><a href="./TagNominationsController.html">TagNominationsController</a></li>
				
					<li><a href="./TagSet.html">TagSet</a></li>
				
					<li><a href="./TagSetAssociation.html">TagSetAssociation</a></li>
				
					<li><a href="./TagSetAssociationsController.html">TagSetAssociationsController</a></li>
				
					<li><a href="./TagSetNomination.html">TagSetNomination</a></li>
				
					<li><a href="./TagSetNominationsController.html">TagSetNominationsController</a></li>
				
					<li><a href="./TagSetOwnership.html">TagSetOwnership</a></li>
				
					<li><a href="./TagSetSweeper.html">TagSetSweeper</a></li>
				
					<li><a href="./TagSetsHelper.html">TagSetsHelper</a></li>
				
					<li><a href="./TagSweeper.html">TagSweeper</a></li>
				
					<li><a href="./TagWranglersController.html">TagWranglersController</a></li>
				
					<li><a href="./TagWranglingsController.html">TagWranglingsController</a></li>
				
					<li><a href="./Taggable.html">Taggable</a></li>
				
					<li><a href="./Tagging.html">Tagging</a></li>
				
					<li><a href="./TagsController.html">TagsController</a></li>
				
					<li><a href="./TagsHelper.html">TagsHelper</a></li>
				
					<li><a href="./TranslationGenerator.html">TranslationGenerator</a></li>
				
					<li><a href="./TranslationHelper.html">TranslationHelper</a></li>
				
					<li><a href="./TranslationNote.html">TranslationNote</a></li>
				
					<li><a href="./TranslationNotesController.html">TranslationNotesController</a></li>
				
					<li><a href="./TranslationsController.html">TranslationsController</a></li>
				
					<li><a href="./TranslatorsController.html">TranslatorsController</a></li>
				
					<li><a href="./UrlActiveValidator.html">UrlActiveValidator</a></li>
				
					<li><a href="./UrlFormatValidator.html">UrlFormatValidator</a></li>
				
					<li><a href="./UrlHelpers.html">UrlHelpers</a></li>
				
					<li><a href="./User.html">User</a></li>
				
					<li><a href="./UserInviteRequest.html">UserInviteRequest</a></li>
				
					<li><a href="./UserInviteRequestsController.html">UserInviteRequestsController</a></li>
				
					<li><a href="./UserInviteRequestsHelper.html">UserInviteRequestsHelper</a></li>
				
					<li><a href="./UserMailer.html">UserMailer</a></li>
				
					<li><a href="./UserSession.html">UserSession</a></li>
				
					<li><a href="./UserSessionsController.html">UserSessionsController</a></li>
				
					<li><a href="./UsersController.html">UsersController</a></li>
				
					<li><a href="./UsersHelper.html">UsersHelper</a></li>
				
					<li><a href="./ValidationHelper.html">ValidationHelper</a></li>
				
					<li><a href="./Warning.html">Warning</a></li>
				
					<li><a href="./WeightedRandom.html">WeightedRandom</a></li>
				
					<li><a href="./Work.html">Work</a></li>
				
					<li><a href="./WorkObserver.html">WorkObserver</a></li>
				
					<li><a href="./WorkSkin.html">WorkSkin</a></li>
				
					<li><a href="./WorkSweeper.html">WorkSweeper</a></li>
				
					<li><a href="./WorksController.html">WorksController</a></li>
				
					<li><a href="./WorksHelper.html">WorksHelper</a></li>
				
					<li><a href="./WranglingAssignment.html">WranglingAssignment</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">WorksController</h1>

		<div id="description">
			<p>
encoding=utf-8
</p>

		</div>

		<!-- Constants -->
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="confirm-delete-method" class="method-detail ">
				<a name="method-i-confirm_delete"></a>

				<div class="method-heading">
				
					<span class="method-name">confirm_delete</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="confirm-delete-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 491</span>
491:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">confirm_delete</span>
492:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="create-method" class="method-detail ">
				<a name="method-i-create"></a>

				<div class="method-heading">
				
					<span class="method-name">create</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
POST /works
</p>
					

					
					<div class="method-source-code"
						id="create-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 254</span>
254:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>
255:     <span class="ruby-identifier">load_pseuds</span>
256:     <span class="ruby-ivar">@series</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">uniq</span>
257: 
258:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:edit_button</span>]
259:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new</span>
260:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cancel_button</span>]
261:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;New work posting canceled.&quot;</span>)
262:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">current_user</span>
263:     <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># now also treating the cancel_coauthor_button case, bc it should function like a preview, really</span>
264:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:preview_button</span>]
265:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">posted</span> = <span class="ruby-keyword kw">true</span>
266:         <span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">posted</span> = <span class="ruby-keyword kw">true</span>
267:       <span class="ruby-keyword kw">end</span>
268:       <span class="ruby-identifier">valid</span> = (<span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">invalid_pseuds</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">ambiguous_pseuds</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span>)
269: 
270:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">valid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">set_revised_at</span>(<span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">published_at</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">set_challenge_info</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">save</span>
271:         <span class="ruby-comment cmt">#hack for empty chapter authors in cucumber series tests</span>
272:         <span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">pseuds</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">blank?</span>
273:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:preview_button</span>]
274:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">preview_work_path</span>(<span class="ruby-ivar">@work</span>), <span class="ruby-value">:notice</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">'Draft was successfully created.'</span>)
275:         <span class="ruby-keyword kw">else</span>
276:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">work_path</span>(<span class="ruby-ivar">@work</span>), <span class="ruby-value">:notice</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">'Work was successfully posted.'</span>)
277:         <span class="ruby-keyword kw">end</span>
278:       <span class="ruby-keyword kw">else</span>
279:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">invalid_pseuds</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">ambiguous_pseuds</span>.<span class="ruby-identifier">blank?</span>)
280:           <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'choose_coauthor'</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'application'</span>
281:         <span class="ruby-keyword kw">else</span>
282:           <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span>
283:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">blank?</span>
284:               <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Please add all required tags. Fandom is missing.&quot;</span>)
285:             <span class="ruby-keyword kw">else</span>
286:               <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Required tags are missing.&quot;</span>)
287:             <span class="ruby-keyword kw">end</span>
288:           <span class="ruby-keyword kw">end</span>
289:           <span class="ruby-identifier">render</span> <span class="ruby-value">:new</span>
290:         <span class="ruby-keyword kw">end</span>
291:       <span class="ruby-keyword kw">end</span>
292:     <span class="ruby-keyword kw">end</span>
293:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="destroy-method" class="method-detail ">
				<a name="method-i-destroy"></a>

				<div class="method-heading">
				
					<span class="method-name">destroy</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
DELETE /works/1
</p>
					

					
					<div class="method-source-code"
						id="destroy-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 495</span>
495:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy</span>
496:     <span class="ruby-ivar">@work</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
497:     <span class="ruby-keyword kw">begin</span>
498:       <span class="ruby-identifier">was_draft</span> = <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">posted?</span>
499:       <span class="ruby-identifier">title</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">title</span>
500:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">destroy</span>
501:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Your work %{title} was deleted.&quot;</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>)
502:     <span class="ruby-keyword kw">rescue</span>
503:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;We couldn't delete that right now, sorry! Please try again later.&quot;</span>)
504:     <span class="ruby-keyword kw">end</span>
505:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">was_draft</span>
506:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">drafts_user_works_path</span>(<span class="ruby-identifier">current_user</span>)
507:     <span class="ruby-keyword kw">else</span>
508:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">user_works_path</span>(<span class="ruby-identifier">current_user</span>)
509:     <span class="ruby-keyword kw">end</span>
510:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="drafts-method" class="method-detail ">
				<a name="method-i-drafts"></a>

				<div class="method-heading">
				
					<span class="method-name">drafts</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="drafts-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 159</span>
159:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">drafts</span>
160:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]
161:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Whose drafts did you want to look at?&quot;</span>)
162:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:users</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:index</span>
163:     <span class="ruby-keyword kw">else</span>
164:       <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_login</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>])
165:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_user</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@user</span>
166:         <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;You can only see your own drafts, sorry!&quot;</span>)
167:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">current_user</span>
168:       <span class="ruby-keyword kw">else</span>
169:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud_id</span>]
170:           <span class="ruby-ivar">@author</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud_id</span>])
171:           <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">unposted_works</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>])
172:         <span class="ruby-keyword kw">else</span>
173:           <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">unposted_works</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>])
174:         <span class="ruby-keyword kw">end</span>
175:       <span class="ruby-keyword kw">end</span>
176:     <span class="ruby-keyword kw">end</span>
177:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="edit-method" class="method-detail ">
				<a name="method-i-edit"></a>

				<div class="method-heading">
				
					<span class="method-name">edit</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
GET /works/1/edit
</p>
					

					
					<div class="method-source-code"
						id="edit-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 296</span>
296:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>
297:     <span class="ruby-ivar">@hide_dashboard</span> = <span class="ruby-keyword kw">true</span>
298:     <span class="ruby-ivar">@chapters</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">chapters_in_order</span>(<span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">number_of_chapters</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
299:     <span class="ruby-identifier">load_pseuds</span>
300:     <span class="ruby-ivar">@series</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">uniq</span>
301:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;remove&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;me&quot;</span>
302:       <span class="ruby-identifier">pseuds_with_author_removed</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">pseuds</span>
303:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pseuds_with_author_removed</span>.<span class="ruby-identifier">empty?</span>
304:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'orphans'</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'new'</span>, <span class="ruby-value">:work_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">id</span>
305:       <span class="ruby-keyword kw">else</span>
306:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">remove_author</span>(<span class="ruby-identifier">current_user</span>)
307:         <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;You have been removed as an author from the work&quot;</span>)
308:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">current_user</span>
309:       <span class="ruby-keyword kw">end</span>
310:     <span class="ruby-keyword kw">end</span>
311:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="edit-multiple-method" class="method-detail ">
				<a name="method-i-edit_multiple"></a>

				<div class="method-heading">
				
					<span class="method-name">edit_multiple</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="edit-multiple-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 683</span>
683:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_multiple</span>
684:     <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
685:     <span class="ruby-ivar">@works</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:work_ids</span>]) &amp; <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">works</span>
686: 
687:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="edit-tags-method" class="method-detail ">
				<a name="method-i-edit_tags"></a>

				<div class="method-heading">
				
					<span class="method-name">edit_tags</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
GET /works/1/edit_tags
</p>
					

					
					<div class="method-source-code"
						id="edit-tags-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 314</span>
314:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_tags</span>
315:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="import-method" class="method-detail ">
				<a name="method-i-import"></a>

				<div class="method-heading">
				
					<span class="method-name">import</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
POST /works/import
</p>
					

					
					<div class="method-source-code"
						id="import-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 513</span>
513:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">import</span>
514:     <span class="ruby-comment cmt"># check to make sure we have some urls to work with</span>
515:     <span class="ruby-ivar">@urls</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:urls</span>].<span class="ruby-identifier">split</span>
516:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@urls</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
517:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Did you want to enter a URL?&quot;</span>)
518:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new_import</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
519:     <span class="ruby-keyword kw">end</span>
520: 
521:     <span class="ruby-comment cmt"># is this an archivist importing?</span>
522:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:importing_for_others</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">archivist</span>
523:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;You may not import stories by other users unless you are an approved archivist.&quot;</span>)
524:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new_import</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
525:     <span class="ruby-keyword kw">end</span>
526: 
527:     <span class="ruby-comment cmt"># make sure we're not importing too many at once</span>
528:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:import_multiple</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;works&quot;</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">archivist</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@urls</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">IMPORT_MAX_WORKS</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@urls</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">IMPORT_MAX_WORKS_BY_ARCHIVIST</span>)
529:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;You cannot import more than %{max} works at a time.&quot;</span>, <span class="ruby-value">:max</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">archivist</span> <span class="ruby-operator">?</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">IMPORT_MAX_WORKS_BY_ARCHIVIST</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">IMPORT_MAX_WORKS</span>)
530:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new_import</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
531:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:import_multiple</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;chapters&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@urls</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">IMPORT_MAX_CHAPTERS</span>
532:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;You cannot import more than %{max} chapters at a time.&quot;</span>, <span class="ruby-value">:max</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">IMPORT_MAX_CHAPTERS</span>)
533:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new_import</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
534:     <span class="ruby-keyword kw">end</span>
535: 
536:     <span class="ruby-comment cmt"># otherwise let's build the options</span>
537:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pseuds_to_apply</span>]
538:       <span class="ruby-identifier">pseuds_to_apply</span> = <span class="ruby-constant">Pseud</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:pseuds_to_apply</span>])
539:     <span class="ruby-keyword kw">end</span>
540:     <span class="ruby-identifier">options</span> = {<span class="ruby-value">:pseuds</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pseuds_to_apply</span>,
541:       <span class="ruby-value">:post_without_preview</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:post_without_preview</span>],
542:       <span class="ruby-value">:importing_for_others</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:importing_for_others</span>],
543:       <span class="ruby-value">:restricted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:restricted</span>],
544:       <span class="ruby-value">:override_tags</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:override_tags</span>],
545:       <span class="ruby-value">:fandom</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:fandom_string</span>],
546:       <span class="ruby-value">:warning</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:warning_strings</span>],
547:       <span class="ruby-value">:character</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:character_string</span>],
548:       <span class="ruby-value">:rating</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:rating_string</span>],
549:       <span class="ruby-value">:relationship</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:relationship_string</span>],
550:       <span class="ruby-value">:category</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:category_string</span>],
551:       <span class="ruby-value">:freeform</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:freeform_string</span>],
552:       <span class="ruby-value">:encoding</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:encoding</span>]
553:     }
554: 
555:     <span class="ruby-comment cmt"># now let's do the import</span>
556:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:import_multiple</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;works&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@urls</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
557:       <span class="ruby-identifier">import_multiple</span>(<span class="ruby-ivar">@urls</span>, <span class="ruby-identifier">options</span>)
558:     <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># a single work possibly with multiple chapters</span>
559:       <span class="ruby-identifier">import_single</span>(<span class="ruby-ivar">@urls</span>, <span class="ruby-identifier">options</span>)
560:     <span class="ruby-keyword kw">end</span>
561: 
562:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="index-method" class="method-detail ">
				<a name="method-i-index"></a>

				<div class="method-heading">
				
					<span class="method-name">index</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
GET /works
</p>
					

					
					<div class="method-source-code"
						id="index-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 38</span>
 38:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
 39:     <span class="ruby-comment cmt"># what we're getting for the view</span>
 40:     <span class="ruby-ivar">@works</span> = []
 41:     <span class="ruby-ivar">@filters</span> = {}
 42:     <span class="ruby-ivar">@pseuds</span> = []
 43: 
 44:     <span class="ruby-comment cmt"># default values for our inputs</span>
 45:     <span class="ruby-ivar">@user</span> = <span class="ruby-keyword kw">nil</span>
 46:     <span class="ruby-ivar">@tag</span> = <span class="ruby-keyword kw">nil</span>
 47:     <span class="ruby-ivar">@selected_tags</span> = []
 48:     <span class="ruby-ivar">@selected_pseuds</span> = []
 49:     <span class="ruby-ivar">@sort_column</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_column</span>]
 50:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'author'</span>
 51:         <span class="ruby-value str">'authors_to_sort_on'</span>
 52:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'title'</span>
 53:         <span class="ruby-value str">'title_to_sort_on'</span> 
 54:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'word_count'</span>
 55:         <span class="ruby-value str">'word_count'</span>
 56:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'hit_count'</span>
 57:         <span class="ruby-value str">'hit_count'</span>
 58:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'created_at'</span>
 59:         <span class="ruby-value str">'created_at'</span>
 60:       <span class="ruby-keyword kw">else</span>
 61:         <span class="ruby-value str">'revised_at'</span>
 62:       <span class="ruby-keyword kw">end</span>
 63:     <span class="ruby-ivar">@sort_direction</span> = (<span class="ruby-identifier">valid_sort_direction</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>]) <span class="ruby-operator">?</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>] <span class="ruby-operator">:</span> <span class="ruby-value str">'DESC'</span>)
 64:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">valid_sort_direction</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>])
 65:       <span class="ruby-identifier">params</span>[<span class="ruby-value">:sort_direction</span>] = <span class="ruby-value str">'DESC'</span>
 66:     <span class="ruby-keyword kw">end</span>
 67:     <span class="ruby-comment cmt"># numerical ids for now</span>
 68:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:selected_pseuds</span>].<span class="ruby-identifier">blank?</span>
 69:       <span class="ruby-keyword kw">begin</span>
 70:         <span class="ruby-ivar">@selected_pseuds</span> = <span class="ruby-constant">Pseud</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:selected_pseuds</span>]).<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:id</span>).<span class="ruby-identifier">uniq</span>
 71:       <span class="ruby-keyword kw">rescue</span>
 72:         <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Sorry, we couldn't find one or more of the authors you selected. Please try again.&quot;</span>)
 73:       <span class="ruby-keyword kw">end</span>
 74:     <span class="ruby-keyword kw">end</span>
 75: 
 76:     <span class="ruby-comment cmt"># if the user is filtering with tags, let's see what they're giving us</span>
 77:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:selected_tags</span>].<span class="ruby-identifier">blank?</span>
 78:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:selected_tags</span>].<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:values</span>)
 79:         <span class="ruby-identifier">params</span>[<span class="ruby-value">:selected_tags</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:selected_tags</span>].<span class="ruby-identifier">values</span>.<span class="ruby-identifier">flatten</span>
 80:       <span class="ruby-keyword kw">end</span>
 81:       <span class="ruby-ivar">@selected_tags</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:selected_tags</span>]
 82:     <span class="ruby-keyword kw">end</span>
 83: 
 84:     <span class="ruby-comment cmt"># if we're browsing by a particular tag, just add that</span>
 85:     <span class="ruby-comment cmt"># tag to the selected_tags list.</span>
 86:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:tag_id</span>].<span class="ruby-identifier">blank?</span>
 87:       <span class="ruby-ivar">@tag</span> = <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:tag_id</span>])
 88:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag</span>
 89:         <span class="ruby-ivar">@tag</span> = <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">merger</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">merger</span>
 90:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">url_for</span>({<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:tags</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:show</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@tag</span>}) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">canonical</span>
 91:         <span class="ruby-ivar">@selected_tags</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@selected_tags</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@tag</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>)
 92:       <span class="ruby-keyword kw">else</span>
 93:         <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Sorry, there's no tag by that name in our system.&quot;</span>)
 94:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">works_path</span>
 95:         <span class="ruby-keyword kw">return</span>
 96:       <span class="ruby-keyword kw">end</span>
 97:     <span class="ruby-keyword kw">end</span>
 98: 
 99:     <span class="ruby-comment cmt"># if we're browsing by a particular user get works by that user</span>
100:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">blank?</span>
101:       <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_login</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>])
102:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@user</span>
103:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud_id</span>].<span class="ruby-identifier">blank?</span>
104:           <span class="ruby-ivar">@author</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud_id</span>])
105:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@author</span>
106:             <span class="ruby-ivar">@selected_pseuds</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@selected_pseuds</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@author</span>.<span class="ruby-identifier">id</span>)
107:           <span class="ruby-keyword kw">end</span>
108:         <span class="ruby-keyword kw">end</span>
109:       <span class="ruby-keyword kw">else</span>
110:         <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Sorry, there's no user by that name in our system.&quot;</span>)
111:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">works_path</span>
112:         <span class="ruby-keyword kw">return</span>
113:       <span class="ruby-keyword kw">end</span>
114:     <span class="ruby-keyword kw">end</span>
115: 
116:     <span class="ruby-ivar">@language</span> = <span class="ruby-constant">Language</span>.<span class="ruby-identifier">find_by_short</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:language_id</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:language_id</span>]
117:     <span class="ruby-comment cmt"># Workaround for the getting-all-English-works problem</span>
118:     <span class="ruby-comment cmt"># TODO: better limits</span>
119:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@language</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@language</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Language</span>.<span class="ruby-identifier">default</span>
120:       <span class="ruby-ivar">@most_recent_works</span> = <span class="ruby-keyword kw">true</span>
121:     <span class="ruby-keyword kw">end</span>
122: 
123:     <span class="ruby-comment cmt"># Now let's build the query</span>
124:     <span class="ruby-ivar">@works</span>, <span class="ruby-ivar">@filters</span>, <span class="ruby-ivar">@pseuds</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find_with_options</span>(<span class="ruby-value">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>, 
125:                                                     <span class="ruby-value">:author</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@author</span>, 
126:                                                     <span class="ruby-value">:selected_pseuds</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@selected_pseuds</span>,
127:                                                     <span class="ruby-value">:tag</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@tag</span>, 
128:                                                     <span class="ruby-value">:selected_tags</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@selected_tags</span>,
129:                                                     <span class="ruby-value">:collection</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@collection</span>,
130:                                                     <span class="ruby-value">:language_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@language</span>,
131:                                                     <span class="ruby-value">:sort_column</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sort_column</span>, 
132:                                                     <span class="ruby-value">:sort_direction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sort_direction</span>,
133:                                                     <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], 
134:                                                     <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:per_page</span>],
135:                                                     <span class="ruby-value">:boolean_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:boolean_type</span>],
136:                                                     <span class="ruby-value">:complete</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:complete</span>])
137: 
138: 
139:     <span class="ruby-comment cmt"># Limit the number of works returned and let users know that it's happening</span>
140:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">total_entries</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">SEARCH_RESULTS_MAX</span>
141:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-node">&quot;More than #{ArchiveConfig.SEARCH_RESULTS_MAX} works were returned. The first #{ArchiveConfig.SEARCH_RESULTS_MAX} works
142:       we found using the current sort and filters are shown.&quot;</span>
143:     <span class="ruby-keyword kw">end</span>
144: 
145:     <span class="ruby-comment cmt"># we now have @works found</span>
146:     <span class="ruby-ivar">@over_anon_threshold</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:authors_to_sort_on</span>).<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">ANONYMOUS_THRESHOLD_COUNT</span>
147: 
148:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@selected_tags</span>.<span class="ruby-identifier">empty?</span>
149:       <span class="ruby-keyword kw">begin</span>
150:         <span class="ruby-comment cmt"># build filters so we can go back</span>
151:         <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;We couldn't find any results using all those filters, sorry! You can unselect some and filter again to get more matches.&quot;</span>)
152:         <span class="ruby-ivar">@filters</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">build_filters_from_tags</span>(<span class="ruby-constant">Tag</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@selected_tags</span>))
153:       <span class="ruby-keyword kw">rescue</span>
154:         <span class="ruby-comment cmt"># do we need more than the regular flash notice?</span>
155:       <span class="ruby-keyword kw">end</span>
156:     <span class="ruby-keyword kw">end</span>
157:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="marktoread-method" class="method-detail ">
				<a name="method-i-marktoread"></a>

				<div class="method-heading">
				
					<span class="method-name">marktoread</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
marks a work to read later, or unmarks it if the work is already marked
</p>
					

					
					<div class="method-source-code"
						id="marktoread-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 706</span>
706:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">marktoread</span>
707:     <span class="ruby-ivar">@work</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
708:     <span class="ruby-constant">Reading</span>.<span class="ruby-identifier">mark_to_read_later</span>(<span class="ruby-ivar">@work</span>, <span class="ruby-identifier">current_user</span>)
709:     <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Your history was updated. It may take a short while to show up.&quot;</span>)
710:     <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;HTTP_REFERER&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">root_path</span>)
711:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="navigate-method" class="method-detail ">
				<a name="method-i-navigate"></a>

				<div class="method-heading">
				
					<span class="method-name">navigate</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="navigate-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 219</span>
219:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">navigate</span>
220:     <span class="ruby-ivar">@chapters</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">chapters_in_order</span>(<span class="ruby-keyword kw">false</span>)
221:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="new-method" class="method-detail ">
				<a name="method-i-new"></a>

				<div class="method-heading">
				
					<span class="method-name">new</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
GET /works/new
</p>
					

					
					<div class="method-source-code"
						id="new-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 224</span>
224:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
225:     <span class="ruby-ivar">@hide_dashboard</span> = <span class="ruby-keyword kw">true</span>
226:     <span class="ruby-identifier">load_pseuds</span>
227:     <span class="ruby-ivar">@series</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">uniq</span>
228:     <span class="ruby-ivar">@unposted</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">unposted_work</span>
229:     <span class="ruby-comment cmt"># for clarity, add the collection and recipient</span>
230:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:assignment_id</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@challenge_assignment</span> = <span class="ruby-constant">ChallengeAssignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:assignment_id</span>])) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@challenge_assignment</span>.<span class="ruby-identifier">offering_user</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>
231:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">challenge_assignments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@challenge_assignment</span>
232:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">collections</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@challenge_assignment</span>.<span class="ruby-identifier">collection</span>
233:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">recipients</span> = <span class="ruby-ivar">@challenge_assignment</span>.<span class="ruby-identifier">requesting_pseud</span>.<span class="ruby-identifier">byline</span>
234:     <span class="ruby-keyword kw">else</span>
235:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">collection_names</span> = <span class="ruby-ivar">@collection</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@collection</span>
236:     <span class="ruby-keyword kw">end</span>
237:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:claim_id</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@challenge_claim</span> = <span class="ruby-constant">ChallengeClaim</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:claim_id</span>])) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@challenge_claim</span>.<span class="ruby-identifier">claiming_user_id</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>
238:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">challenge_claims</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@challenge_claim</span>
239:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">collections</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@challenge_claim</span>.<span class="ruby-identifier">collection</span>
240:     <span class="ruby-keyword kw">else</span>
241:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">collection_names</span> = <span class="ruby-ivar">@collection</span>.<span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@collection</span>
242:     <span class="ruby-keyword kw">end</span>
243:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:import</span>]
244:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new_import</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
245:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:load_unposted</span>]
246:       <span class="ruby-ivar">@work</span> = <span class="ruby-ivar">@unposted</span>
247:       <span class="ruby-identifier">render</span> <span class="ruby-value">:edit</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
248:     <span class="ruby-keyword kw">else</span>
249:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
250:     <span class="ruby-keyword kw">end</span>
251:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="post-draft-method" class="method-detail ">
				<a name="method-i-post_draft"></a>

				<div class="method-heading">
				
					<span class="method-name">post_draft</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="post-draft-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 643</span>
643:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_draft</span>
644:     <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
645:     <span class="ruby-ivar">@work</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
646:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">is_author_of?</span>(<span class="ruby-ivar">@work</span>)
647:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;You can only post your own works.&quot;</span>)
648:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">current_user</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
649:     <span class="ruby-keyword kw">end</span>
650: 
651:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">posted</span>
652:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;That work is already posted. Do you want to edit it instead?&quot;</span>)
653:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_user_work_path</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@work</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
654:     <span class="ruby-keyword kw">end</span>
655: 
656:     <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">posted</span> = <span class="ruby-keyword kw">true</span>
657:     <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">minor_version</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">minor_version</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
658:     <span class="ruby-comment cmt"># @work.update_minor_version</span>
659:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">valid?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">save</span>
660:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;There were problems posting your work.&quot;</span>)
661:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">edit_user_work_path</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@work</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
662:     <span class="ruby-keyword kw">end</span>
663: 
664:     <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Your work was successfully posted.&quot;</span>)
665:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@work</span>
666:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="preview-method" class="method-detail ">
				<a name="method-i-preview"></a>

				<div class="method-heading">
				
					<span class="method-name">preview</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
GET /works/1/preview
</p>
					

					
					<div class="method-source-code"
						id="preview-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 482</span>
482:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">preview</span>
483:     <span class="ruby-ivar">@preview_mode</span> = <span class="ruby-keyword kw">true</span>
484:     <span class="ruby-identifier">load_pseuds</span>
485:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="preview-tags-method" class="method-detail ">
				<a name="method-i-preview_tags"></a>

				<div class="method-heading">
				
					<span class="method-name">preview_tags</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="preview-tags-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 487</span>
487:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">preview_tags</span>
488:     <span class="ruby-ivar">@preview_mode</span> = <span class="ruby-keyword kw">true</span>
489:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="search-method" class="method-detail ">
				<a name="method-i-search"></a>

				<div class="method-heading">
				
					<span class="method-name">search</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="search-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 21</span>
21:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">search</span>
22:     <span class="ruby-ivar">@languages</span> = <span class="ruby-constant">Language</span>.<span class="ruby-identifier">default_order</span>
23:     <span class="ruby-ivar">@query</span> = {}
24:     <span class="ruby-comment cmt"># to understand this, the code you are looking for is in lib/query.rb</span>
25:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>]
26:       <span class="ruby-ivar">@query</span> = <span class="ruby-constant">Query</span>.<span class="ruby-identifier">standardize</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>])
27:       <span class="ruby-keyword kw">begin</span>
28:         <span class="ruby-identifier">page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1</span>
29:         <span class="ruby-identifier">errors</span>, <span class="ruby-ivar">@works</span> = <span class="ruby-constant">Query</span>.<span class="ruby-identifier">search_with_sphinx</span>(<span class="ruby-constant">Work</span>, <span class="ruby-ivar">@query</span>, <span class="ruby-identifier">page</span>)
30:         <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">blank?</span>
31:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Riddle</span><span class="ruby-operator">::</span><span class="ruby-constant">ConnectionError</span>
32:         <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;The search engine seems to be down at the moment, sorry!&quot;</span>)
33:       <span class="ruby-keyword kw">end</span>
34:     <span class="ruby-keyword kw">end</span>
35:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="show-method" class="method-detail ">
				<a name="method-i-show"></a>

				<div class="method-heading">
				
					<span class="method-name">show</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
GET /works/1 GET /works/1.xml
</p>
					

					
					<div class="method-source-code"
						id="show-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 181</span>
181:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show</span>
182:     <span class="ruby-comment cmt"># Users must explicitly okay viewing of adult content</span>
183:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:view_adult</span>]
184:       <span class="ruby-identifier">session</span>[<span class="ruby-value">:adult</span>] = <span class="ruby-keyword kw">true</span>
185:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">adult?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">see_adult?</span>
186:       <span class="ruby-identifier">render</span> <span class="ruby-value str">&quot;_adult&quot;</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;application&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
187:     <span class="ruby-keyword kw">end</span>
188: 
189:     <span class="ruby-comment cmt"># Users must explicitly okay viewing of entire work</span>
190:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">number_of_posted_chapters</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
191:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:view_full_work</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">logged_in?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">preference</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:view_full_works</span>))
192:         <span class="ruby-ivar">@chapters</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">chapters_in_order</span>
193:       <span class="ruby-keyword kw">else</span>
194:         <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">keep</span>
195:         <span class="ruby-identifier">redirect_to</span> [<span class="ruby-ivar">@work</span>, <span class="ruby-ivar">@chapter</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
196:       <span class="ruby-keyword kw">end</span>
197:     <span class="ruby-keyword kw">end</span>
198: 
199:     <span class="ruby-ivar">@tag_categories_limited</span> = <span class="ruby-constant">Tag</span><span class="ruby-operator">::</span><span class="ruby-constant">VISIBLE</span> <span class="ruby-operator">-</span> [<span class="ruby-value str">&quot;Warning&quot;</span>]
200: 
201:     <span class="ruby-ivar">@page_title</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">unrevealed?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Mystery Work&quot;</span>) <span class="ruby-operator">:</span>
202:       <span class="ruby-identifier">get_page_title</span>(<span class="ruby-ivar">@work</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Multifandom&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">string</span>,
203:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">anonymous?</span> <span class="ruby-operator">?</span>  <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Anonymous&quot;</span>)  <span class="ruby-operator">:</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:byline</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>),
204:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">title</span>)
205:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">unrevealed?</span>
206:         <span class="ruby-ivar">@tweet_text</span> = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Mystery Work&quot;</span>)
207:       <span class="ruby-keyword kw">else</span>
208:         <span class="ruby-ivar">@tweet_text</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; by &quot;</span> <span class="ruby-operator">+</span>
209:                       (<span class="ruby-ivar">@work</span>.<span class="ruby-identifier">anonymous?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Anonymous&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:name</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; - &quot;</span> <span class="ruby-operator">+</span>
210:                       (<span class="ruby-ivar">@work</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Multifandom&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">string</span>)
211:         <span class="ruby-ivar">@tweet_text</span> = <span class="ruby-ivar">@tweet_text</span>.<span class="ruby-identifier">truncate</span>(<span class="ruby-value">95</span>)
212:       <span class="ruby-keyword kw">end</span>
213:     <span class="ruby-identifier">render</span> <span class="ruby-value">:show</span>
214:     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Work remote addr: #{request.remote_ip}&quot;</span>
215:     <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">increment_hit_count</span>(<span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>)
216:     <span class="ruby-constant">Reading</span>.<span class="ruby-identifier">update_or_create</span>(<span class="ruby-ivar">@work</span>, <span class="ruby-identifier">current_user</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_user</span>
217:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="show-multiple-method" class="method-detail ">
				<a name="method-i-show_multiple"></a>

				<div class="method-heading">
				
					<span class="method-name">show_multiple</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
WORK ON MULTIPLE WORKS
</p>
					

					
					<div class="method-source-code"
						id="show-multiple-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 670</span>
670:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show_multiple</span>
671:     <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
672:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud_id</span>]
673:       <span class="ruby-ivar">@author</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud_id</span>])
674:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@author</span>.<span class="ruby-identifier">works</span>
675:     <span class="ruby-keyword kw">else</span>
676:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">works</span>
677:     <span class="ruby-keyword kw">end</span>
678:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work_ids</span>]
679:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span> &amp; <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:work_ids</span>])
680:     <span class="ruby-keyword kw">end</span>
681:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="update-method" class="method-detail ">
				<a name="method-i-update"></a>

				<div class="method-heading">
				
					<span class="method-name">update</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
PUT /works/1
</p>
					

					
					<div class="method-source-code"
						id="update-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 318</span>
318:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
319:     <span class="ruby-comment cmt"># Need to get @pseuds and @series values before rendering edit</span>
320:     <span class="ruby-identifier">load_pseuds</span>
321:     <span class="ruby-ivar">@series</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">uniq</span>
322:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
323:       <span class="ruby-identifier">render</span> <span class="ruby-value">:edit</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
324:     <span class="ruby-keyword kw">end</span>
325: 
326:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">invalid_pseuds</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">ambiguous_pseuds</span>.<span class="ruby-identifier">blank?</span>
327:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">valid?</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">render</span> <span class="ruby-value">:_choose_coauthor</span>) <span class="ruby-operator">:</span> (<span class="ruby-identifier">render</span> <span class="ruby-value">:new</span>)
328:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:preview_button</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cancel_coauthor_button</span>]
329:       <span class="ruby-ivar">@preview_mode</span> = <span class="ruby-keyword kw">true</span>
330:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">invalid_tags</span>.<span class="ruby-identifier">blank?</span>
331:         <span class="ruby-ivar">@chapter</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@chapter</span>
332:         <span class="ruby-identifier">render</span> <span class="ruby-value">:preview</span>
333:       <span class="ruby-keyword kw">else</span>
334:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">invalid_tags</span>.<span class="ruby-identifier">blank?</span>
335:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">check_for_invalid_tags</span>
336:         <span class="ruby-keyword kw">end</span>
337:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">blank?</span>
338:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Updating: Please add all required tags. Fandom is missing.&quot;</span>)
339:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span>
340:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Updating: Please add all required tags.&quot;</span>)
341:         <span class="ruby-keyword kw">end</span>
342:         <span class="ruby-identifier">render</span> <span class="ruby-value">:edit</span>
343:       <span class="ruby-keyword kw">end</span>
344:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cancel_button</span>]
345:       <span class="ruby-identifier">cancel_posting_and_redirect</span>
346:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:edit_button</span>]
347:       <span class="ruby-identifier">render</span> <span class="ruby-value">:edit</span>
348:     <span class="ruby-keyword kw">else</span>
349:       <span class="ruby-identifier">saved</span> = <span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">save</span>
350:       <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">saved</span> = <span class="ruby-keyword kw">false</span>
351:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">saved</span>
352:         <span class="ruby-comment cmt"># Setting the @work.revised_at datetime if appropriate</span>
353:         <span class="ruby-comment cmt"># if @chapter.published_at has been changed or work is being posted</span>
354:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:post_button</span>] <span class="ruby-operator">||</span> (<span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@previous_published_at</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@previous_published_at</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">published_at</span>)
355:           <span class="ruby-comment cmt"># if work has only one chapter - so we don't need to take any other chapter dates into account,</span>
356:           <span class="ruby-comment cmt"># OR the date is set to today AND the backdating setting has not been changed</span>
357:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">number_of_chapters</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">||</span> (<span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">published_at</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@previous_backdate_setting</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@previous_backdate_setting</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">backdate</span>)
358:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">set_revised_at</span>(<span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">published_at</span>)
359:           <span class="ruby-comment cmt"># work has more than one chapter and the published_at date for this chapter is not today</span>
360:           <span class="ruby-comment cmt"># so we can't tell if there is a later date than this one elsewhere, and need to grab all</span>
361:           <span class="ruby-comment cmt"># OR the date is today but the backdate setting has changed</span>
362:           <span class="ruby-keyword kw">else</span>
363:             <span class="ruby-comment cmt"># if backdate has been changed to positive</span>
364:             <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@previous_backdate_setting</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@previous_backdate_setting</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">backdate</span>
365:               <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">set_revised_at</span>(<span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">published_at</span>) <span class="ruby-comment cmt"># set revised_at to the date on this form</span>
366:             <span class="ruby-comment cmt"># if backdate has been changed to negative</span>
367:             <span class="ruby-comment cmt"># OR there is no change in the backdate setting but the date isn't today</span>
368:             <span class="ruby-keyword kw">else</span>
369:               <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">set_revised_at</span>
370:             <span class="ruby-keyword kw">end</span>
371:           <span class="ruby-keyword kw">end</span>
372:         <span class="ruby-comment cmt"># elsif the date hasn't been changed, but the backdate setting has</span>
373:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@previous_backdate_setting</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@previous_backdate_setting</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">backdate</span>
374:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@previous_backdate_setting</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">backdate</span>  <span class="ruby-comment cmt"># if backdate has been changed to positive</span>
375:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">set_revised_at</span>(<span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">published_at</span>) <span class="ruby-comment cmt"># set revised_at to the date on this form</span>
376:           <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># if backdate has been changed to negative, grab most recent chapter date</span>
377:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">set_revised_at</span>
378:           <span class="ruby-keyword kw">end</span>
379:         <span class="ruby-keyword kw">end</span>
380:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">challenge_claims</span>.<span class="ruby-identifier">empty?</span>
381:           <span class="ruby-ivar">@included</span> = <span class="ruby-value">0</span>
382:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">challenge_claims</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">claim</span><span class="ruby-operator">|</span>
383:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">collections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">collection</span><span class="ruby-operator">|</span>
384:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">collection</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">claim</span>.<span class="ruby-identifier">collection</span>
385:                 <span class="ruby-ivar">@included</span> = <span class="ruby-value">1</span>
386:               <span class="ruby-keyword kw">end</span>
387:             <span class="ruby-keyword kw">end</span>
388:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@included</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
389:               <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">collections</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">claim</span>.<span class="ruby-identifier">collection</span>
390:             <span class="ruby-keyword kw">end</span>
391:             <span class="ruby-ivar">@included</span> = <span class="ruby-value">0</span>
392:           <span class="ruby-keyword kw">end</span>
393:         <span class="ruby-keyword kw">end</span>
394:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">posted</span> = <span class="ruby-keyword kw">true</span>
395:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">minor_version</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">minor_version</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
396:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">set_challenge_info</span>
397:         <span class="ruby-identifier">saved</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">save</span>
398:       <span class="ruby-keyword kw">end</span>
399:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">saved</span>
400:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:post_button</span>]
401:           <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">'Work was successfully posted.'</span>)
402:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:update_button</span>]
403:           <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">'Work was successfully updated.'</span>)
404:         <span class="ruby-keyword kw">end</span>
405: 
406:         <span class="ruby-comment cmt">#bleep += &quot;  AFTER SAVE: author attr: &quot; + params[:work][:author_attributes][:ids].collect {|a| a}.inspect + &quot;  @work.authors: &quot; + @work.authors.collect {|au| au.id}.inspect + &quot;  @work.pseuds: &quot; + @work.pseuds.collect {|ps| ps.id}.inspect</span>
407:         <span class="ruby-comment cmt">#flash[:notice] = &quot;DEBUG: in UPDATE save:  &quot; + bleep</span>
408: 
409:         <span class="ruby-identifier">redirect_to</span>(<span class="ruby-ivar">@work</span>)
410:       <span class="ruby-keyword kw">else</span>
411:         <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">valid?</span>
412:           <span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">err</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-identifier">err</span>)}
413:         <span class="ruby-keyword kw">end</span>
414:         <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span>
415:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">blank?</span>
416:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Updating: Please add all required tags. Fandom is missing.&quot;</span>)
417:           <span class="ruby-keyword kw">else</span>
418:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Updating: Required tags are missing.&quot;</span>)
419:           <span class="ruby-keyword kw">end</span>
420:         <span class="ruby-keyword kw">end</span>
421:         <span class="ruby-identifier">render</span> <span class="ruby-value">:edit</span>
422:       <span class="ruby-keyword kw">end</span>
423:     <span class="ruby-keyword kw">end</span>
424:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="update-multiple-method" class="method-detail ">
				<a name="method-i-update_multiple"></a>

				<div class="method-heading">
				
					<span class="method-name">update_multiple</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="update-multiple-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 689</span>
689:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_multiple</span>
690:     <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
691:     <span class="ruby-ivar">@works</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:work_ids</span>]) &amp; <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">works</span>
692:     <span class="ruby-ivar">@errors</span> = []
693:     <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">work</span><span class="ruby-operator">|</span>
694:       <span class="ruby-comment cmt"># actual stuff will happen here shortly</span>
695:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">work</span>.<span class="ruby-identifier">update_attributes!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>].<span class="ruby-identifier">reject</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">blank?</span>})
696:         <span class="ruby-ivar">@errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;The work %{title} could not be edited: %{error}&quot;</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">work</span>.<span class="ruby-identifier">title</span>, <span class="ruby-value">:error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">work</span>.<span class="ruby-identifier">errors_on</span>.<span class="ruby-identifier">to_s</span>)
697:       <span class="ruby-keyword kw">end</span>
698:     <span class="ruby-keyword kw">end</span>
699:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@errors</span>.<span class="ruby-identifier">empty?</span>
700:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;There were problems editing some works: %{errors}&quot;</span>, <span class="ruby-value">:errors</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@errors</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>))
701:     <span class="ruby-keyword kw">end</span>
702:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">show_multiple_user_works_path</span>(<span class="ruby-ivar">@user</span>)
703:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="update-tags-method" class="method-detail ">
				<a name="method-i-update_tags"></a>

				<div class="method-heading">
				
					<span class="method-name">update_tags</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="update-tags-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 426</span>
426:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_tags</span>
427:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
428:       <span class="ruby-identifier">render</span> <span class="ruby-value">:edit_tags</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
429:     <span class="ruby-keyword kw">end</span>
430: 
431:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:preview_button</span>]
432:       <span class="ruby-ivar">@preview_mode</span> = <span class="ruby-keyword kw">true</span>
433: 
434:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">invalid_tags</span>.<span class="ruby-identifier">blank?</span>
435:         <span class="ruby-identifier">render</span> <span class="ruby-value">:preview_tags</span>
436:       <span class="ruby-keyword kw">else</span>
437:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">invalid_tags</span>.<span class="ruby-identifier">blank?</span>
438:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">check_for_invalid_tags</span>
439:         <span class="ruby-keyword kw">end</span>
440:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">blank?</span>
441:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Updating: Please add all required tags. Fandom is missing.&quot;</span>)
442:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span>
443:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Updating: Please add all required tags.&quot;</span>)
444:         <span class="ruby-keyword kw">end</span>
445:         <span class="ruby-identifier">render</span> <span class="ruby-value">:edit_tags</span>
446:       <span class="ruby-keyword kw">end</span>
447:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cancel_button</span>]
448:       <span class="ruby-identifier">cancel_posting_and_redirect</span>
449:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:edit_button</span>]
450:       <span class="ruby-identifier">render</span> <span class="ruby-value">:edit_tags</span>
451:     <span class="ruby-keyword kw">else</span>
452:       <span class="ruby-identifier">saved</span> = <span class="ruby-keyword kw">true</span>
453: 
454:       (<span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">invalid_tags</span>.<span class="ruby-identifier">blank?</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">saved</span> = <span class="ruby-keyword kw">false</span>
455:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">saved</span>
456:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">posted</span> = <span class="ruby-keyword kw">true</span>
457:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">minor_version</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">minor_version</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
458:         <span class="ruby-identifier">saved</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">save</span>
459:         <span class="ruby-comment cmt"># @work.update_minor_version</span>
460:       <span class="ruby-keyword kw">end</span>
461:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">saved</span>
462:         <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">'Work was successfully updated.'</span>)
463:         <span class="ruby-identifier">redirect_to</span>(<span class="ruby-ivar">@work</span>)
464:       <span class="ruby-keyword kw">else</span>
465:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">invalid_tags</span>.<span class="ruby-identifier">blank?</span>
466:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">check_for_invalid_tags</span>
467:         <span class="ruby-keyword kw">end</span>
468:         <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">has_required_tags?</span>
469:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">blank?</span>
470:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Updating: Please add all required tags. Fandom is missing.&quot;</span>)
471:           <span class="ruby-keyword kw">else</span>
472:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Updating: Required tags are missing.&quot;</span>)
473:           <span class="ruby-keyword kw">end</span>
474:         <span class="ruby-keyword kw">end</span>
475:         <span class="ruby-identifier">render</span> <span class="ruby-value">:edit_tags</span>
476:       <span class="ruby-keyword kw">end</span>
477:     <span class="ruby-keyword kw">end</span>
478:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="protected-instance-method-details" class="method-section section">
			<h3 class="section-header">Protected Instance Methods</h3>

		
			<div id="cancel-posting-and-redirect-method" class="method-detail ">
				<a name="method-i-cancel_posting_and_redirect"></a>

				<div class="method-heading">
				
					<span class="method-name">cancel_posting_and_redirect</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="cancel-posting-and-redirect-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 816</span>
816:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cancel_posting_and_redirect</span>
817:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">posted</span>
818:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;The work was not updated.&quot;</span>)
819:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">user_works_path</span>(<span class="ruby-identifier">current_user</span>)
820:     <span class="ruby-keyword kw">else</span>
821:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;The work was not posted. It will be saved here in your drafts for one week, then cleaned up.&quot;</span>)
822:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">drafts_user_works_path</span>(<span class="ruby-identifier">current_user</span>)
823:     <span class="ruby-keyword kw">end</span>
824:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="import-multiple-method" class="method-detail ">
				<a name="method-i-import_multiple"></a>

				<div class="method-heading">
				
					<span class="method-name">import_multiple</span><span
						class="method-args">(urls, options)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
import multiple works
</p>
					

					
					<div class="method-source-code"
						id="import-multiple-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 603</span>
603:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">import_multiple</span>(<span class="ruby-identifier">urls</span>, <span class="ruby-identifier">options</span>)
604:     <span class="ruby-comment cmt"># try a multiple import</span>
605:     <span class="ruby-identifier">storyparser</span> = <span class="ruby-constant">StoryParser</span>.<span class="ruby-identifier">new</span>
606:     <span class="ruby-ivar">@works</span>, <span class="ruby-identifier">failed_urls</span>, <span class="ruby-identifier">errors</span> = <span class="ruby-identifier">storyparser</span>.<span class="ruby-identifier">import_from_urls</span>(<span class="ruby-identifier">urls</span>, <span class="ruby-identifier">options</span>)
607: 
608:     <span class="ruby-comment cmt"># collect the errors neatly, matching each error to the failed url</span>
609:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">failed_urls</span>.<span class="ruby-identifier">empty?</span>
610:       <span class="ruby-identifier">error_msgs</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-identifier">failed_urls</span>.<span class="ruby-identifier">length</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">index</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;&lt;dt&gt;#{failed_urls[index]}&lt;/dt&gt;&lt;dd&gt;#{errors[index]}&lt;/dd&gt;&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
611:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-node">&quot;&lt;h3&gt;#{ts('Failed Imports')}&lt;/h3&gt;&lt;dl&gt;#{error_msgs}&lt;/dl&gt;&quot;</span>.<span class="ruby-identifier">html_safe</span>
612:     <span class="ruby-keyword kw">end</span>
613: 
614:     <span class="ruby-comment cmt"># if EVERYTHING failed, boo. :( Go back to the import form.</span>
615:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">empty?</span>
616:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new_import</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
617:     <span class="ruby-keyword kw">end</span>
618: 
619:     <span class="ruby-comment cmt"># if we got here, we have at least some successfully imported works</span>
620:     <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Importing completed successfully for the following works! (But please check the results over carefully!)&quot;</span>)
621:     <span class="ruby-identifier">send_external_invites</span>(<span class="ruby-ivar">@works</span>)
622: 
623:     <span class="ruby-comment cmt"># fall through to import template</span>
624:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="import-single-method" class="method-detail ">
				<a name="method-i-import_single"></a>

				<div class="method-heading">
				
					<span class="method-name">import_single</span><span
						class="method-args">(urls, options)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
import a single work (possibly with multiple chapters)
</p>
					

					
					<div class="method-source-code"
						id="import-single-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 567</span>
567:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">import_single</span>(<span class="ruby-identifier">urls</span>, <span class="ruby-identifier">options</span>)
568:     <span class="ruby-comment cmt"># try the import</span>
569:     <span class="ruby-identifier">storyparser</span> = <span class="ruby-constant">StoryParser</span>.<span class="ruby-identifier">new</span>
570:     <span class="ruby-keyword kw">begin</span>
571:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">urls</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
572:         <span class="ruby-ivar">@work</span> = <span class="ruby-identifier">storyparser</span>.<span class="ruby-identifier">download_and_parse_story</span>(<span class="ruby-identifier">urls</span>.<span class="ruby-identifier">first</span>, <span class="ruby-identifier">options</span>)
573:       <span class="ruby-keyword kw">else</span>
574:         <span class="ruby-ivar">@work</span> = <span class="ruby-identifier">storyparser</span>.<span class="ruby-identifier">download_and_parse_chapters_into_story</span>(<span class="ruby-identifier">urls</span>, <span class="ruby-identifier">options</span>)
575:       <span class="ruby-keyword kw">end</span>
576:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>
577:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Import has timed out. This may be due to connectivity problems with the source site. Please try again in a few minutes, or check Known Issues to see if there are import problems with this site.&quot;</span>)
578:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new_import</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
579:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">StoryParser</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exception</span>
580:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;We couldn't successfully import that work, sorry: %{message}&quot;</span>, <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exception</span>.<span class="ruby-identifier">message</span>)
581:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new_import</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
582:     <span class="ruby-keyword kw">end</span>
583: 
584:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@work</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">save</span>
585:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;We were only partially able to import this work and couldn't save it. Please review below!&quot;</span>)
586:       <span class="ruby-ivar">@chapter</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">first</span>
587:       <span class="ruby-identifier">load_pseuds</span>
588:       <span class="ruby-ivar">@series</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">uniq</span>
589:       <span class="ruby-identifier">render</span> <span class="ruby-value">:new</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
590:     <span class="ruby-keyword kw">end</span>
591: 
592:     <span class="ruby-comment cmt"># Otherwise, we have a saved work, go us</span>
593:     <span class="ruby-identifier">send_external_invites</span>([<span class="ruby-ivar">@work</span>])
594:     <span class="ruby-ivar">@chapter</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">first_chapter</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>
595:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">posted</span>
596:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">work_path</span>(<span class="ruby-ivar">@work</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
597:     <span class="ruby-keyword kw">else</span>
598:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">preview_work_path</span>(<span class="ruby-ivar">@work</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
599:     <span class="ruby-keyword kw">end</span>
600:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="load-pseuds-method" class="method-detail ">
				<a name="method-i-load_pseuds"></a>

				<div class="method-heading">
				
					<span class="method-name">load_pseuds</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="load-pseuds-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 715</span>
715:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_pseuds</span>
716:     <span class="ruby-ivar">@allpseuds</span> = (<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@work</span>.<span class="ruby-identifier">authors</span> <span class="ruby-operator">||=</span> []) <span class="ruby-operator">+</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">pseuds</span>).<span class="ruby-identifier">uniq</span>
717:     <span class="ruby-ivar">@pseuds</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">pseuds</span>
718:     <span class="ruby-ivar">@coauthors</span> = <span class="ruby-ivar">@allpseuds</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>}
719:     <span class="ruby-identifier">to_select</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">authors</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> [<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">default_pseud</span>] <span class="ruby-operator">:</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">authors</span>
720:     <span class="ruby-ivar">@selected_pseuds</span> = <span class="ruby-identifier">to_select</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">pseud</span><span class="ruby-operator">|</span> <span class="ruby-identifier">pseud</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_i</span> }.<span class="ruby-identifier">uniq</span>
721:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="load-work-method" class="method-detail ">
				<a name="method-i-load_work"></a>

				<div class="method-heading">
				
					<span class="method-name">load_work</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="load-work-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 723</span>
723:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_work</span>
724:     <span class="ruby-ivar">@work</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
725:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">nil?</span>
726:       <span class="ruby-identifier">flash</span>[<span class="ruby-value">:error</span>] = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Sorry, we couldn't find the work you were looking for.&quot;</span>)
727:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
728:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@collection</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@work</span>.<span class="ruby-identifier">collections</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@collection</span>)
729:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@work</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">return</span>
730:     <span class="ruby-keyword kw">end</span>
731:     <span class="ruby-ivar">@check_ownership_of</span> = <span class="ruby-ivar">@work</span>
732:     <span class="ruby-ivar">@check_visibility_of</span> = <span class="ruby-ivar">@work</span>
733:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="send-external-invites-method" class="method-detail ">
				<a name="method-i-send_external_invites"></a>

				<div class="method-heading">
				
					<span class="method-name">send_external_invites</span><span
						class="method-args">(works)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
if we are importing for others, we need to send invitations
</p>
					

					
					<div class="method-source-code"
						id="send-external-invites-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 627</span>
627:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_external_invites</span>(<span class="ruby-identifier">works</span>)
628:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:importing_for_others</span>]
629:       <span class="ruby-ivar">@external_authors</span> = <span class="ruby-identifier">works</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:external_authors</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
630:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@external_authors</span>.<span class="ruby-identifier">empty?</span>
631:         <span class="ruby-ivar">@external_authors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">external_author</span><span class="ruby-operator">|</span>
632:           <span class="ruby-identifier">external_author</span>.<span class="ruby-identifier">find_or_invite</span>(<span class="ruby-identifier">current_user</span>)
633:         <span class="ruby-keyword kw">end</span>
634:         <span class="ruby-identifier">message</span> = <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;We have notified the author(s) you imported stories for. If any were missed, you can also add co-authors manually.&quot;</span>)
635:         <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">message</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">message</span>
636:       <span class="ruby-keyword kw">end</span>
637:     <span class="ruby-keyword kw">end</span>
638:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="set-author-attributes-method" class="method-detail ">
				<a name="method-i-set_author_attributes"></a>

				<div class="method-heading">
				
					<span class="method-name">set_author_attributes</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
set the author attributes
</p>
					

					
					<div class="method-source-code"
						id="set-author-attributes-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 772</span>
772:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_author_attributes</span>
773:     <span class="ruby-comment cmt"># if we don't have author_attributes[:ids], which shouldn't be allowed to happen</span>
774:     <span class="ruby-comment cmt"># (this can happen if a user with multiple pseuds decides to unselect *all* of them)</span>
775:     <span class="ruby-identifier">sorry</span> = <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;You haven't selected any pseuds for this work. Please use Remove Me As Author or consider orphaning your work instead if you do not wish to be associated with it anymore.&quot;</span>)
776:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>][<span class="ruby-value">:ids</span>]
777:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">sorry</span>
778:       <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>][<span class="ruby-value">:ids</span>] = [<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">default_pseud</span>]
779:     <span class="ruby-keyword kw">end</span>
780:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>]
781:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-identifier">sorry</span>
782:       <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>] = {<span class="ruby-value">:ids</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">default_pseud</span>]}
783:     <span class="ruby-keyword kw">end</span>
784: 
785:     <span class="ruby-comment cmt"># stuff new bylines into author attributes to be parsed by the work model</span>
786:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud</span>][<span class="ruby-value">:byline</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud</span>][<span class="ruby-value">:byline</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
787:       <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>][<span class="ruby-value">:byline</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud</span>][<span class="ruby-value">:byline</span>]
788:       <span class="ruby-identifier">params</span>[<span class="ruby-value">:pseud</span>][<span class="ruby-value">:byline</span>] = <span class="ruby-value str">&quot;&quot;</span>
789:     <span class="ruby-keyword kw">end</span>
790: 
791:     <span class="ruby-comment cmt"># stuff co-authors into author attributes too so we won't lose them</span>
792:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>][<span class="ruby-value">:coauthors</span>]
793:       <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>][<span class="ruby-value">:ids</span>].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:author_attributes</span>][<span class="ruby-value">:coauthors</span>]).<span class="ruby-identifier">uniq!</span>
794:     <span class="ruby-keyword kw">end</span>
795:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="set-instance-variables-method" class="method-detail ">
				<a name="method-i-set_instance_variables"></a>

				<div class="method-heading">
				
					<span class="method-name">set_instance_variables</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Sets values for @work, @chapter, @coauthor_results, @pseuds, and
@selected_pseuds and @tags[category]
</p>
					

					
					<div class="method-source-code"
						id="set-instance-variables-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 737</span>
737:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_instance_variables</span>
738:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>] <span class="ruby-comment cmt"># edit, update, preview, manage_chapters</span>
739:       <span class="ruby-ivar">@work</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
740:       <span class="ruby-ivar">@previous_published_at</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">first_chapter</span>.<span class="ruby-identifier">published_at</span>
741:       <span class="ruby-ivar">@previous_backdate_setting</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">backdate</span>
742:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>]  <span class="ruby-comment cmt"># editing, save our changes</span>
743:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:preview_button</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cancel_button</span>]
744:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">preview_mode</span> = <span class="ruby-keyword kw">true</span>
745:         <span class="ruby-keyword kw">else</span>
746:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">preview_mode</span> = <span class="ruby-keyword kw">false</span>
747:         <span class="ruby-keyword kw">end</span>
748:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>]
749:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">save_parents</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">preview_mode</span>
750:       <span class="ruby-keyword kw">end</span>
751:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>] <span class="ruby-comment cmt"># create</span>
752:       <span class="ruby-ivar">@work</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>])
753:     <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># new</span>
754:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:load_unposted</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">unposted_work</span>
755:         <span class="ruby-ivar">@work</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">unposted_work</span>
756:       <span class="ruby-keyword kw">else</span>
757:         <span class="ruby-ivar">@work</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">new</span>
758:         <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">build</span>
759:       <span class="ruby-keyword kw">end</span>
760:     <span class="ruby-keyword kw">end</span>
761: 
762:     <span class="ruby-ivar">@serial_works</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">serial_works</span>
763: 
764:     <span class="ruby-ivar">@chapter</span> = <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">first_chapter</span>
765:     <span class="ruby-comment cmt"># If we're in preview mode, we want to pick up any changes that have been made to the first chapter</span>
766:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:chapter_attributes</span>]
767:       <span class="ruby-ivar">@chapter</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>][<span class="ruby-value">:chapter_attributes</span>]
768:     <span class="ruby-keyword kw">end</span>
769:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="set-instance-variables-tags-method" class="method-detail ">
				<a name="method-i-set_instance_variables_tags"></a>

				<div class="method-heading">
				
					<span class="method-name">set_instance_variables_tags</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Sets values for @work and @tags[category]
</p>
					

					
					<div class="method-source-code"
						id="set-instance-variables-tags-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 798</span>
798:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_instance_variables_tags</span>
799:     <span class="ruby-keyword kw">begin</span>
800:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>] <span class="ruby-comment cmt"># edit_tags, update_tags, preview_tags</span>
801:         <span class="ruby-ivar">@work</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
802:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>]  <span class="ruby-comment cmt"># editing, save our changes</span>
803:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:preview_button</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cancel_button</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:edit_button</span>]
804:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">preview_mode</span> = <span class="ruby-keyword kw">true</span>
805:           <span class="ruby-keyword kw">else</span>
806:             <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">preview_mode</span> = <span class="ruby-keyword kw">false</span>
807:           <span class="ruby-keyword kw">end</span>
808:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:work</span>]
809:           <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">save_parents</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@work</span>.<span class="ruby-identifier">preview_mode</span>
810:         <span class="ruby-keyword kw">end</span>
811:       <span class="ruby-keyword kw">end</span>
812:     <span class="ruby-keyword kw">rescue</span>
813:     <span class="ruby-keyword kw">end</span>
814:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="tag-list-method" class="method-detail ">
				<a name="method-i-tag_list"></a>

				<div class="method-heading">
				
					<span class="method-name">tag_list</span><span
						class="method-args">(tags)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Takes an array of tags and returns a comma-separated list, without the
markup
</p>
					

					
					<div class="method-source-code"
						id="tag-list-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/works_controller.rb, line 827</span>
827:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tag_list</span>(<span class="ruby-identifier">tags</span>)
828:     <span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">compact</span>
829:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tags</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:collect</span>)
830:       <span class="ruby-identifier">last_tag</span> = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">pop</span>
831:       <span class="ruby-identifier">tag_list</span> = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>  <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;, &quot;</span>}.<span class="ruby-identifier">join</span>
832:       <span class="ruby-identifier">tag_list</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">last_tag</span>.<span class="ruby-identifier">name</span>
833:       <span class="ruby-identifier">tag_list</span>.<span class="ruby-identifier">html_safe</span>
834:     <span class="ruby-keyword kw">else</span>
835:       <span class="ruby-value str">&quot;&quot;</span>
836:     <span class="ruby-keyword kw">end</span>
837:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

