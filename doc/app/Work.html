<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: Work</title>

	<link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

	<script src="./js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="./app/models/work_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="app/models/work.rb">app/models/work.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link">ActiveRecord::Base</p>
				
			</div>
			

			<!-- Namespace Contents -->
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-c-build_filters">::build_filters</a></li>
					
					<li><a href="#method-c-build_filters_from_tags">::build_filters_from_tags</a></li>
					
					<li><a href="#method-c-find_with_options">::find_with_options</a></li>
					
					<li><a href="#method-c-in_series">::in_series</a></li>
					
					<li><a href="#method-c-no_tags">::no_tags</a></li>
					
					<li><a href="#method-c-purge_old_drafts">::purge_old_drafts</a></li>
					
					<li><a href="#method-c-visible">::visible</a></li>
					
					<li><a href="#method-c-visible_to_user">::visible_to_user</a></li>
					
					<li><a href="#method-i-%3C%3D%3E">#<=></a></li>
					
					<li><a href="#method-i-add_filter_tagging">#add_filter_tagging</a></li>
					
					<li><a href="#method-i-adjust_filter_counts">#adjust_filter_counts</a></li>
					
					<li><a href="#method-i-adjust_series_restriction">#adjust_series_restriction</a></li>
					
					<li><a href="#method-i-anonymous%3F">#anonymous?</a></li>
					
					<li><a href="#method-i-author_attributes%3D">#author_attributes=</a></li>
					
					<li><a href="#method-i-challenge_assignment_ids">#challenge_assignment_ids</a></li>
					
					<li><a href="#method-i-challenge_assignment_ids%3D">#challenge_assignment_ids=</a></li>
					
					<li><a href="#method-i-challenge_claim_ids">#challenge_claim_ids</a></li>
					
					<li><a href="#method-i-change_ownership">#change_ownership</a></li>
					
					<li><a href="#method-i-chapter_attributes%3D">#chapter_attributes=</a></li>
					
					<li><a href="#method-i-chapter_total_display">#chapter_total_display</a></li>
					
					<li><a href="#method-i-chaptered%3F">#chaptered?</a></li>
					
					<li><a href="#method-i-chapters_in_order">#chapters_in_order</a></li>
					
					<li><a href="#method-i-check_filter_counts">#check_filter_counts</a></li>
					
					<li><a href="#method-i-check_for_invalid_chapters">#check_for_invalid_chapters</a></li>
					
					<li><a href="#method-i-clean_and_validate_title">#clean_and_validate_title</a></li>
					
					<li><a href="#method-i-comments">#comments</a></li>
					
					<li><a href="#method-i-count_all_comments">#count_all_comments</a></li>
					
					<li><a href="#method-i-create_hit_counter">#create_hit_counter</a></li>
					
					<li><a href="#method-i-database_hits">#database_hits</a></li>
					
					<li><a href="#method-i-default_date">#default_date</a></li>
					
					<li><a href="#method-i-destroy_chapters_in_reverse">#destroy_chapters_in_reverse</a></li>
					
					<li><a href="#method-i-display_authors">#display_authors</a></li>
					
					<li><a href="#method-i-download_authors">#download_authors</a></li>
					
					<li><a href="#method-i-download_basename">#download_basename</a></li>
					
					<li><a href="#method-i-download_dir">#download_dir</a></li>
					
					<li><a href="#method-i-download_fandoms">#download_fandoms</a></li>
					
					<li><a href="#method-i-download_title">#download_title</a></li>
					
					<li><a href="#method-i-ensure_revised_at">#ensure_revised_at</a></li>
					
					<li><a href="#method-i-find_all_comments">#find_all_comments</a></li>
					
					<li><a href="#method-i-first_chapter">#first_chapter</a></li>
					
					<li><a href="#method-i-has_required_tags%3F">#has_required_tags?</a></li>
					
					<li><a href="#method-i-hits">#hits</a></li>
					
					<li><a href="#method-i-increment_hit_count">#increment_hit_count</a></li>
					
					<li><a href="#method-i-is_complete">#is_complete</a></li>
					
					<li><a href="#method-i-is_wip">#is_wip</a></li>
					
					<li><a href="#method-i-last_chapter">#last_chapter</a></li>
					
					<li><a href="#method-i-last_visitor">#last_visitor</a></li>
					
					<li><a href="#method-i-multipart%3F">#multipart?</a></li>
					
					<li><a href="#method-i-number_of_chapters">#number_of_chapters</a></li>
					
					<li><a href="#method-i-number_of_posted_chapters">#number_of_posted_chapters</a></li>
					
					<li><a href="#method-i-parent_attributes%3D">#parent_attributes=</a></li>
					
					<li><a href="#method-i-parents">#parents</a></li>
					
					<li><a href="#method-i-post_first_chapter">#post_first_chapter</a></li>
					
					<li><a href="#method-i-published_at">#published_at</a></li>
					
					<li><a href="#method-i-recipients">#recipients</a></li>
					
					<li><a href="#method-i-recipients%3D">#recipients=</a></li>
					
					<li><a href="#method-i-redis_key">#redis_key</a></li>
					
					<li><a href="#method-i-remove_author">#remove_author</a></li>
					
					<li><a href="#method-i-remove_filter_tagging">#remove_filter_tagging</a></li>
					
					<li><a href="#method-i-remove_outdated_downloads">#remove_outdated_downloads</a></li>
					
					<li><a href="#method-i-reorder">#reorder</a></li>
					
					<li><a href="#method-i-save_chapters">#save_chapters</a></li>
					
					<li><a href="#method-i-save_parents">#save_parents</a></li>
					
					<li><a href="#method-i-series_attributes%3D">#series_attributes=</a></li>
					
					<li><a href="#method-i-set_challenge_claim_info">#set_challenge_claim_info</a></li>
					
					<li><a href="#method-i-set_challenge_info">#set_challenge_info</a></li>
					
					<li><a href="#method-i-set_revised_at">#set_revised_at</a></li>
					
					<li><a href="#method-i-set_word_count">#set_word_count</a></li>
					
					<li><a href="#method-i-sorted_authors">#sorted_authors</a></li>
					
					<li><a href="#method-i-sorted_pseuds">#sorted_pseuds</a></li>
					
					<li><a href="#method-i-sorted_title">#sorted_title</a></li>
					
					<li><a href="#method-i-tag_groups">#tag_groups</a></li>
					
					<li><a href="#method-i-unrevealed%3F">#unrevealed?</a></li>
					
					<li><a href="#method-i-update_complete_status">#update_complete_status</a></li>
					
					<li><a href="#method-i-update_major_version">#update_major_version</a></li>
					
					<li><a href="#method-i-update_minor_version">#update_minor_version</a></li>
					
					<li><a href="#method-i-validate_authors">#validate_authors</a></li>
					
					<li><a href="#method-i-validate_published_at">#validate_published_at</a></li>
					
					<li><a href="#method-i-visibility_changed%3F">#visibility_changed?</a></li>
					
					<li><a href="#method-i-visible">#visible</a></li>
					
					<li><a href="#method-i-visible%3F">#visible?</a></li>
					
					<li><a href="#method-i-wip_length">#wip_length</a></li>
					
					<li><a href="#method-i-wip_length%3D">#wip_length=</a></li>
					
					<li><a href="#method-i-work_skin_allowed">#work_skin_allowed</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
			<div id="includes-section" class="section">
				<h3 class="section-header">Included Modules</h3>
				<ul class="link-list">
				
				
					<li><a class="include" href="Taggable.html">Taggable</a></li>
				
				
				
					<li><a class="include" href="Collectible.html">Collectible</a></li>
				
				
				</ul>
			</div>
			
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
					<li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="./images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="./Static.html">Static</a></li>
				
					<li><a href="./Static/BaseController.html">Static::BaseController</a></li>
				
					<li><a href="./Static/CollectionsController.html">Static::CollectionsController</a></li>
				
					<li><a href="./Static/FandomsController.html">Static::FandomsController</a></li>
				
					<li><a href="./Static/MediaController.html">Static::MediaController</a></li>
				
					<li><a href="./Static/RestrictedWorksController.html">Static::RestrictedWorksController</a></li>
				
					<li><a href="./Static/WorksController.html">Static::WorksController</a></li>
				
					<li><a href="./Admin.html">Admin</a></li>
				
					<li><a href="./Admin/AdminInvitationsController.html">Admin::AdminInvitationsController</a></li>
				
					<li><a href="./Admin/AdminUsersController.html">Admin::AdminUsersController</a></li>
				
					<li><a href="./Admin/SettingsController.html">Admin::SettingsController</a></li>
				
					<li><a href="./Admin/SkinsController.html">Admin::SkinsController</a></li>
				
					<li><a href="./Admin/UserCreationsController.html">Admin::UserCreationsController</a></li>
				
					<li><a href="./ActionController.html">ActionController</a></li>
				
					<li><a href="./ActionController/Routing.html">ActionController::Routing</a></li>
				
					<li><a href="./ActionController/Routing/RouteSet.html">ActionController::Routing::RouteSet</a></li>
				
					<li><a href="./Challenge.html">Challenge</a></li>
				
					<li><a href="./Challenge/GiftExchangeController.html">Challenge::GiftExchangeController</a></li>
				
					<li><a href="./Challenge/PromptMemeController.html">Challenge::PromptMemeController</a></li>
				
					<li><a href="./ActiveRecord.html">ActiveRecord</a></li>
				
					<li><a href="./AutocompleteSource.html">AutocompleteSource</a></li>
				
					<li><a href="./AutocompleteSource/ClassMethods.html">AutocompleteSource::ClassMethods</a></li>
				
					<li><a href="./ChallengeCore.html">ChallengeCore</a></li>
				
					<li><a href="./ChallengeCore/ClassMethods.html">ChallengeCore::ClassMethods</a></li>
				
					<li><a href="./StoryParser.html">StoryParser</a></li>
				
					<li><a href="./StoryParser/Error.html">StoryParser::Error</a></li>
				
					<li><a href="./XhtmlSplitter.html">XhtmlSplitter</a></li>
				
					<li><a href="./XhtmlSplitter/Error.html">XhtmlSplitter::Error</a></li>
				
					<li><a href="./AbuseReport.html">AbuseReport</a></li>
				
					<li><a href="./AbuseReportsController.html">AbuseReportsController</a></li>
				
					<li><a href="./AdminMailer.html">AdminMailer</a></li>
				
					<li><a href="./AdminPost.html">AdminPost</a></li>
				
					<li><a href="./AdminPostTag.html">AdminPostTag</a></li>
				
					<li><a href="./AdminPostTagging.html">AdminPostTagging</a></li>
				
					<li><a href="./AdminPostsController.html">AdminPostsController</a></li>
				
					<li><a href="./AdminSession.html">AdminSession</a></li>
				
					<li><a href="./AdminSessionsController.html">AdminSessionsController</a></li>
				
					<li><a href="./AdminSetting.html">AdminSetting</a></li>
				
					<li><a href="./AdminsController.html">AdminsController</a></li>
				
					<li><a href="./AdvancedSearchHelper.html">AdvancedSearchHelper</a></li>
				
					<li><a href="./AlphabetHelper.html">AlphabetHelper</a></li>
				
					<li><a href="./ApplicationController.html">ApplicationController</a></li>
				
					<li><a href="./ApplicationHelper.html">ApplicationHelper</a></li>
				
					<li><a href="./ArchiveFaq.html">ArchiveFaq</a></li>
				
					<li><a href="./ArchiveFaqsController.html">ArchiveFaqsController</a></li>
				
					<li><a href="./AuthlogicHelpersForMailers.html">AuthlogicHelpersForMailers</a></li>
				
					<li><a href="./AutocompleteController.html">AutocompleteController</a></li>
				
					<li><a href="./Banned.html">Banned</a></li>
				
					<li><a href="./Bookmark.html">Bookmark</a></li>
				
					<li><a href="./BookmarksController.html">BookmarksController</a></li>
				
					<li><a href="./BookmarksHelper.html">BookmarksHelper</a></li>
				
					<li><a href="./CacheHelper.html">CacheHelper</a></li>
				
					<li><a href="./CastNomination.html">CastNomination</a></li>
				
					<li><a href="./Category.html">Category</a></li>
				
					<li><a href="./ChallengeAssignment.html">ChallengeAssignment</a></li>
				
					<li><a href="./ChallengeAssignmentsController.html">ChallengeAssignmentsController</a></li>
				
					<li><a href="./ChallengeClaim.html">ChallengeClaim</a></li>
				
					<li><a href="./ChallengeClaimsController.html">ChallengeClaimsController</a></li>
				
					<li><a href="./ChallengeHelper.html">ChallengeHelper</a></li>
				
					<li><a href="./ChallengeRequestsController.html">ChallengeRequestsController</a></li>
				
					<li><a href="./ChallengeSignup.html">ChallengeSignup</a></li>
				
					<li><a href="./ChallengeSignupObserver.html">ChallengeSignupObserver</a></li>
				
					<li><a href="./ChallengeSignupSweeper.html">ChallengeSignupSweeper</a></li>
				
					<li><a href="./ChallengeSignupsController.html">ChallengeSignupsController</a></li>
				
					<li><a href="./ChallengeSweeper.html">ChallengeSweeper</a></li>
				
					<li><a href="./ChallengesController.html">ChallengesController</a></li>
				
					<li><a href="./Chapter.html">Chapter</a></li>
				
					<li><a href="./ChapterSweeper.html">ChapterSweeper</a></li>
				
					<li><a href="./ChaptersController.html">ChaptersController</a></li>
				
					<li><a href="./ChaptersHelper.html">ChaptersHelper</a></li>
				
					<li><a href="./Character.html">Character</a></li>
				
					<li><a href="./CharacterNomination.html">CharacterNomination</a></li>
				
					<li><a href="./Collectible.html">Collectible</a></li>
				
					<li><a href="./Collection.html">Collection</a></li>
				
					<li><a href="./CollectionItem.html">CollectionItem</a></li>
				
					<li><a href="./CollectionItemsController.html">CollectionItemsController</a></li>
				
					<li><a href="./CollectionObserver.html">CollectionObserver</a></li>
				
					<li><a href="./CollectionParticipant.html">CollectionParticipant</a></li>
				
					<li><a href="./CollectionParticipantsController.html">CollectionParticipantsController</a></li>
				
					<li><a href="./CollectionPreference.html">CollectionPreference</a></li>
				
					<li><a href="./CollectionProfile.html">CollectionProfile</a></li>
				
					<li><a href="./CollectionProfileController.html">CollectionProfileController</a></li>
				
					<li><a href="./CollectionSweeper.html">CollectionSweeper</a></li>
				
					<li><a href="./CollectionsController.html">CollectionsController</a></li>
				
					<li><a href="./CollectionsHelper.html">CollectionsHelper</a></li>
				
					<li><a href="./Comment.html">Comment</a></li>
				
					<li><a href="./CommentMailer.html">CommentMailer</a></li>
				
					<li><a href="./CommentObserver.html">CommentObserver</a></li>
				
					<li><a href="./CommentSweeper.html">CommentSweeper</a></li>
				
					<li><a href="./CommentsController.html">CommentsController</a></li>
				
					<li><a href="./CommentsHelper.html">CommentsHelper</a></li>
				
					<li><a href="./CommonTagging.html">CommonTagging</a></li>
				
					<li><a href="./CreationObserver.html">CreationObserver</a></li>
				
					<li><a href="./Creatorship.html">Creatorship</a></li>
				
					<li><a href="./CssCleaner.html">CssCleaner</a></li>
				
					<li><a href="./DateHelper.html">DateHelper</a></li>
				
					<li><a href="./DevmodeController.html">DevmodeController</a></li>
				
					<li><a href="./DownloadsController.html">DownloadsController</a></li>
				
					<li><a href="./EmailVeracityValidator.html">EmailVeracityValidator</a></li>
				
					<li><a href="./ErrorsController.html">ErrorsController</a></li>
				
					<li><a href="./ExternalAuthor.html">ExternalAuthor</a></li>
				
					<li><a href="./ExternalAuthorName.html">ExternalAuthorName</a></li>
				
					<li><a href="./ExternalAuthorsController.html">ExternalAuthorsController</a></li>
				
					<li><a href="./ExternalAuthorsHelper.html">ExternalAuthorsHelper</a></li>
				
					<li><a href="./ExternalCreatorship.html">ExternalCreatorship</a></li>
				
					<li><a href="./ExternalWork.html">ExternalWork</a></li>
				
					<li><a href="./ExternalWorksController.html">ExternalWorksController</a></li>
				
					<li><a href="./Fandom.html">Fandom</a></li>
				
					<li><a href="./FandomNomination.html">FandomNomination</a></li>
				
					<li><a href="./FandomsController.html">FandomsController</a></li>
				
					<li><a href="./FeedSweeper.html">FeedSweeper</a></li>
				
					<li><a href="./Feedback.html">Feedback</a></li>
				
					<li><a href="./FeedbacksController.html">FeedbacksController</a></li>
				
					<li><a href="./FilterCount.html">FilterCount</a></li>
				
					<li><a href="./FilterTagging.html">FilterTagging</a></li>
				
					<li><a href="./FindRandom.html">FindRandom</a></li>
				
					<li><a href="./Freeform.html">Freeform</a></li>
				
					<li><a href="./FreeformNomination.html">FreeformNomination</a></li>
				
					<li><a href="./Gift.html">Gift</a></li>
				
					<li><a href="./GiftExchange.html">GiftExchange</a></li>
				
					<li><a href="./GiftsController.html">GiftsController</a></li>
				
					<li><a href="./HitCounter.html">HitCounter</a></li>
				
					<li><a href="./HomeController.html">HomeController</a></li>
				
					<li><a href="./HomeHelper.html">HomeHelper</a></li>
				
					<li><a href="./HtmlCleaner.html">HtmlCleaner</a></li>
				
					<li><a href="./InboxComment.html">InboxComment</a></li>
				
					<li><a href="./InboxController.html">InboxController</a></li>
				
					<li><a href="./InboxHelper.html">InboxHelper</a></li>
				
					<li><a href="./Invitation.html">Invitation</a></li>
				
					<li><a href="./InvitationsController.html">InvitationsController</a></li>
				
					<li><a href="./InvitationsHelper.html">InvitationsHelper</a></li>
				
					<li><a href="./InviteRequest.html">InviteRequest</a></li>
				
					<li><a href="./InviteRequestsController.html">InviteRequestsController</a></li>
				
					<li><a href="./KnownIssue.html">KnownIssue</a></li>
				
					<li><a href="./KnownIssuesController.html">KnownIssuesController</a></li>
				
					<li><a href="./Kudo.html">Kudo</a></li>
				
					<li><a href="./KudoMailer.html">KudoMailer</a></li>
				
					<li><a href="./KudoObserver.html">KudoObserver</a></li>
				
					<li><a href="./KudosController.html">KudosController</a></li>
				
					<li><a href="./Language.html">Language</a></li>
				
					<li><a href="./LanguagesController.html">LanguagesController</a></li>
				
					<li><a href="./Locale.html">Locale</a></li>
				
					<li><a href="./LocalesController.html">LocalesController</a></li>
				
					<li><a href="./LogItem.html">LogItem</a></li>
				
					<li><a href="./Media.html">Media</a></li>
				
					<li><a href="./MediaController.html">MediaController</a></li>
				
					<li><a href="./MetaTagging.html">MetaTagging</a></li>
				
					<li><a href="./Offer.html">Offer</a></li>
				
					<li><a href="./OrphansController.html">OrphansController</a></li>
				
					<li><a href="./OrphansHelper.html">OrphansHelper</a></li>
				
					<li><a href="./OwnedSetTagging.html">OwnedSetTagging</a></li>
				
					<li><a href="./OwnedTagSet.html">OwnedTagSet</a></li>
				
					<li><a href="./OwnedTagSetsController.html">OwnedTagSetsController</a></li>
				
					<li><a href="./PaginationListLinkRenderer.html">PaginationListLinkRenderer</a></li>
				
					<li><a href="./PasswordsController.html">PasswordsController</a></li>
				
					<li><a href="./People.html">People</a></li>
				
					<li><a href="./PeopleController.html">PeopleController</a></li>
				
					<li><a href="./PotentialMatch.html">PotentialMatch</a></li>
				
					<li><a href="./PotentialMatchSettings.html">PotentialMatchSettings</a></li>
				
					<li><a href="./PotentialMatchesController.html">PotentialMatchesController</a></li>
				
					<li><a href="./PotentialPromptMatch.html">PotentialPromptMatch</a></li>
				
					<li><a href="./Preference.html">Preference</a></li>
				
					<li><a href="./PreferencesController.html">PreferencesController</a></li>
				
					<li><a href="./Profile.html">Profile</a></li>
				
					<li><a href="./ProfileController.html">ProfileController</a></li>
				
					<li><a href="./Prompt.html">Prompt</a></li>
				
					<li><a href="./PromptMeme.html">PromptMeme</a></li>
				
					<li><a href="./PromptRestriction.html">PromptRestriction</a></li>
				
					<li><a href="./PromptRestrictionsHelper.html">PromptRestrictionsHelper</a></li>
				
					<li><a href="./PromptsController.html">PromptsController</a></li>
				
					<li><a href="./Pseud.html">Pseud</a></li>
				
					<li><a href="./PseudSweeper.html">PseudSweeper</a></li>
				
					<li><a href="./PseudsController.html">PseudsController</a></li>
				
					<li><a href="./PseudsHelper.html">PseudsHelper</a></li>
				
					<li><a href="./Query.html">Query</a></li>
				
					<li><a href="./Rating.html">Rating</a></li>
				
					<li><a href="./Rawk.html">Rawk</a></li>
				
					<li><a href="./Reading.html">Reading</a></li>
				
					<li><a href="./ReadingsController.html">ReadingsController</a></li>
				
					<li><a href="./RedirectController.html">RedirectController</a></li>
				
					<li><a href="./RedisTestSetup.html">RedisTestSetup</a></li>
				
					<li><a href="./RelatedWork.html">RelatedWork</a></li>
				
					<li><a href="./RelatedWorksController.html">RelatedWorksController</a></li>
				
					<li><a href="./Relationship.html">Relationship</a></li>
				
					<li><a href="./RelationshipNomination.html">RelationshipNomination</a></li>
				
					<li><a href="./Request.html">Request</a></li>
				
					<li><a href="./Role.html">Role</a></li>
				
					<li><a href="./RolesUser.html">RolesUser</a></li>
				
					<li><a href="./SearchController.html">SearchController</a></li>
				
					<li><a href="./SearchHelper.html">SearchHelper</a></li>
				
					<li><a href="./SerialWork.html">SerialWork</a></li>
				
					<li><a href="./SerialWorksController.html">SerialWorksController</a></li>
				
					<li><a href="./Series.html">Series</a></li>
				
					<li><a href="./SeriesController.html">SeriesController</a></li>
				
					<li><a href="./SeriesHelper.html">SeriesHelper</a></li>
				
					<li><a href="./SetTagging.html">SetTagging</a></li>
				
					<li><a href="./Skin.html">Skin</a></li>
				
					<li><a href="./SkinParent.html">SkinParent</a></li>
				
					<li><a href="./SkinsController.html">SkinsController</a></li>
				
					<li><a href="./SkinsHelper.html">SkinsHelper</a></li>
				
					<li><a href="./SortableList.html">SortableList</a></li>
				
					<li><a href="./Stat.html">Stat</a></li>
				
					<li><a href="./StatHash.html">StatHash</a></li>
				
					<li><a href="./StaticSweeper.html">StaticSweeper</a></li>
				
					<li><a href="./StatsController.html">StatsController</a></li>
				
					<li><a href="./StatsHelper.html">StatsHelper</a></li>
				
					<li><a href="./Subscription.html">Subscription</a></li>
				
					<li><a href="./SubscriptionsController.html">SubscriptionsController</a></li>
				
					<li><a href="./Tag.html">Tag</a></li>
				
					<li><a href="./TagNomination.html">TagNomination</a></li>
				
					<li><a href="./TagNominationsController.html">TagNominationsController</a></li>
				
					<li><a href="./TagSet.html">TagSet</a></li>
				
					<li><a href="./TagSetAssociation.html">TagSetAssociation</a></li>
				
					<li><a href="./TagSetAssociationsController.html">TagSetAssociationsController</a></li>
				
					<li><a href="./TagSetNomination.html">TagSetNomination</a></li>
				
					<li><a href="./TagSetNominationsController.html">TagSetNominationsController</a></li>
				
					<li><a href="./TagSetOwnership.html">TagSetOwnership</a></li>
				
					<li><a href="./TagSetSweeper.html">TagSetSweeper</a></li>
				
					<li><a href="./TagSetsHelper.html">TagSetsHelper</a></li>
				
					<li><a href="./TagSweeper.html">TagSweeper</a></li>
				
					<li><a href="./TagWranglersController.html">TagWranglersController</a></li>
				
					<li><a href="./TagWranglingsController.html">TagWranglingsController</a></li>
				
					<li><a href="./Taggable.html">Taggable</a></li>
				
					<li><a href="./Tagging.html">Tagging</a></li>
				
					<li><a href="./TagsController.html">TagsController</a></li>
				
					<li><a href="./TagsHelper.html">TagsHelper</a></li>
				
					<li><a href="./TranslationGenerator.html">TranslationGenerator</a></li>
				
					<li><a href="./TranslationHelper.html">TranslationHelper</a></li>
				
					<li><a href="./TranslationNote.html">TranslationNote</a></li>
				
					<li><a href="./TranslationNotesController.html">TranslationNotesController</a></li>
				
					<li><a href="./TranslationsController.html">TranslationsController</a></li>
				
					<li><a href="./TranslatorsController.html">TranslatorsController</a></li>
				
					<li><a href="./UrlActiveValidator.html">UrlActiveValidator</a></li>
				
					<li><a href="./UrlFormatValidator.html">UrlFormatValidator</a></li>
				
					<li><a href="./UrlHelpers.html">UrlHelpers</a></li>
				
					<li><a href="./User.html">User</a></li>
				
					<li><a href="./UserInviteRequest.html">UserInviteRequest</a></li>
				
					<li><a href="./UserInviteRequestsController.html">UserInviteRequestsController</a></li>
				
					<li><a href="./UserInviteRequestsHelper.html">UserInviteRequestsHelper</a></li>
				
					<li><a href="./UserMailer.html">UserMailer</a></li>
				
					<li><a href="./UserSession.html">UserSession</a></li>
				
					<li><a href="./UserSessionsController.html">UserSessionsController</a></li>
				
					<li><a href="./UsersController.html">UsersController</a></li>
				
					<li><a href="./UsersHelper.html">UsersHelper</a></li>
				
					<li><a href="./ValidationHelper.html">ValidationHelper</a></li>
				
					<li><a href="./Warning.html">Warning</a></li>
				
					<li><a href="./WeightedRandom.html">WeightedRandom</a></li>
				
					<li><a href="./Work.html">Work</a></li>
				
					<li><a href="./WorkObserver.html">WorkObserver</a></li>
				
					<li><a href="./WorkSkin.html">WorkSkin</a></li>
				
					<li><a href="./WorkSweeper.html">WorkSweeper</a></li>
				
					<li><a href="./WorksController.html">WorksController</a></li>
				
					<li><a href="./WorksHelper.html">WorksHelper</a></li>
				
					<li><a href="./WranglingAssignment.html">WranglingAssignment</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">Work</h1>

		<div id="description">
			
		</div>

		<!-- Constants -->
		
		<div id="constants-list" class="section">
			<h3 class="section-header">Constants</h3>
			<dl>
			
				<dt><a name="OWNERSHIP_JOIN">OWNERSHIP_JOIN</a></dt>
				
				<dd class="description"><p>
a string for use in :joins => clause to add ownership lookup
</p></dd>
				
			
				<dt><a name="COMMON_TAG_JOIN">COMMON_TAG_JOIN</a></dt>
				
				<dd class="description"></dd>
				
			
				<dt><a name="VISIBLE_TO_ALL_CONDITIONS">VISIBLE_TO_ALL_CONDITIONS</a></dt>
				
				<dd class="description"></dd>
				
			
				<dt><a name="VISIBLE_TO_USER_CONDITIONS">VISIBLE_TO_USER_CONDITIONS</a></dt>
				
				<dd class="description"></dd>
				
			
				<dt><a name="VISIBLE_TO_ADMIN_CONDITIONS">VISIBLE_TO_ADMIN_CONDITIONS</a></dt>
				
				<dd class="description"></dd>
				
			
			</dl>
		</div>
		

		<!-- Attributes -->
		
		<div id="attribute-method-details" class="method-section section">
			<h3 class="section-header">Attributes</h3>

			
			<div id="authors-attribute-method" class="method-detail">
				<a name="authors"></a>
				
				<a name="authors="></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">authors</span><span
						class="attribute-access-type">[RW]</span>
				</div>

				<div class="method-description">
				
				<p>
Virtual attribute to use as a placeholder for pseuds before the work has
been saved Can&#8217;t write to work.pseuds until the work has an id
</p>
				
				</div>
			</div>
			
			<div id="authors-to-remove-attribute-method" class="method-detail">
				<a name="authors_to_remove"></a>
				
				<a name="authors_to_remove="></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">authors_to_remove</span><span
						class="attribute-access-type">[RW]</span>
				</div>

				<div class="method-description">
				
				
				
				</div>
			</div>
			
			<div id="invalid-pseuds-attribute-method" class="method-detail">
				<a name="invalid_pseuds"></a>
				
				<a name="invalid_pseuds="></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">invalid_pseuds</span><span
						class="attribute-access-type">[RW]</span>
				</div>

				<div class="method-description">
				
				
				
				</div>
			</div>
			
			<div id="ambiguous-pseuds-attribute-method" class="method-detail">
				<a name="ambiguous_pseuds"></a>
				
				<a name="ambiguous_pseuds="></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">ambiguous_pseuds</span><span
						class="attribute-access-type">[RW]</span>
				</div>

				<div class="method-description">
				
				
				
				</div>
			</div>
			
			<div id="new-parent-attribute-method" class="method-detail">
				<a name="new_parent"></a>
				
				<a name="new_parent="></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">new_parent</span><span
						class="attribute-access-type">[RW]</span>
				</div>

				<div class="method-description">
				
				
				
				</div>
			</div>
			
			<div id="url-for-parent-attribute-method" class="method-detail">
				<a name="url_for_parent"></a>
				
				<a name="url_for_parent="></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">url_for_parent</span><span
						class="attribute-access-type">[RW]</span>
				</div>

				<div class="method-description">
				
				
				
				</div>
			</div>
			
			<div id="should-reset-filters-attribute-method" class="method-detail">
				<a name="should_reset_filters"></a>
				
				<a name="should_reset_filters="></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">should_reset_filters</span><span
						class="attribute-access-type">[RW]</span>
				</div>

				<div class="method-description">
				
				
				
				</div>
			</div>
			
		</div>
		

		<!-- Methods -->
		
		<div id="public-class-method-details" class="method-section section">
			<h3 class="section-header">Public Class Methods</h3>

		
			<div id="build-filters-method" class="method-detail ">
				<a name="method-c-build_filters"></a>

				<div class="method-heading">
				
					<span class="method-name">build_filters</span><span
						class="method-args">(works)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Takes an array of works, returns a hash (key = tag type) of arrays of
hashes (of individual tag data) Ex. {&#8216;Fandom&#8217; => [{:name =>
&#8216;Star Trek&#8217;, :id => &#8216;3&#8217;, :count =>
&#8216;50&#8217;}, &#8230;], &#8216;Character&#8217; => &#8230;}
</p>
					

					
					<div class="method-source-code"
						id="build-filters-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/work.rb, line 1059</span>
1059:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build_filters</span>(<span class="ruby-identifier">works</span>)
1060:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build_filters_from_tags</span>(<span class="ruby-constant">Tag</span>.<span class="ruby-identifier">filters_with_count</span>(<span class="ruby-identifier">works</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:id</span>)))
1061:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="build-filters-from-tags-method" class="method-detail ">
				<a name="method-c-build_filters_from_tags"></a>

				<div class="method-heading">
				
					<span class="method-name">build_filters_from_tags</span><span
						class="method-args">(tags)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="build-filters-from-tags-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/work.rb, line 1063</span>
1063:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build_filters_from_tags</span>(<span class="ruby-identifier">tags</span>)
1064:     <span class="ruby-identifier">filters</span> = {}
1065:     <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>
1066:       <span class="ruby-identifier">count</span> = <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:count</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;0&quot;</span>
1067:       (<span class="ruby-identifier">filters</span>[<span class="ruby-identifier">tag</span>.<span class="ruby-identifier">type</span>] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">name</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-value">:count</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">count</span>}
1068:     <span class="ruby-keyword kw">end</span>
1069:     <span class="ruby-identifier">filters</span>
1070:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="find-with-options-method" class="method-detail ">
				<a name="method-c-find_with_options"></a>

				<div class="method-heading">
				
					<span class="method-name">find_with_options</span><span
						class="method-args">(options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Used for non-search work filtering
</p>
					

					
					<div class="method-source-code"
						id="find-with-options-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/work.rb, line 1001</span>
1001:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_with_options</span>(<span class="ruby-identifier">options</span> = {})
1002:     <span class="ruby-identifier">page_args</span> = {<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1</span>, <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">options</span>[<span class="ruby-value">:per_page</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">ITEMS_PER_PAGE</span>)}
1003:     <span class="ruby-identifier">sort_by</span> = <span class="ruby-node">&quot;#{options[:sort_column]} #{options[:sort_direction]}&quot;</span>
1004: 
1005:     <span class="ruby-ivar">@pseuds</span> = []
1006:     <span class="ruby-ivar">@filters</span> = []
1007:     <span class="ruby-ivar">@works</span> = <span class="ruby-constant">Work</span>
1008: 
1009:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:user</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:selected_pseuds</span>].<span class="ruby-identifier">empty?</span>
1010:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">written_by_id</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:selected_pseuds</span>])
1011:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:user</span>].<span class="ruby-identifier">nil?</span>
1012:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">owned_by</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:user</span>])
1013:     <span class="ruby-keyword kw">end</span>
1014: 
1015:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:selected_tags</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:tag</span>].<span class="ruby-identifier">blank?</span>
1016:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:boolean_type</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'or'</span>
1017:         <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">with_any_filter_ids</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:selected_tags</span>])
1018:       <span class="ruby-keyword kw">else</span>
1019:         <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">with_all_filter_ids</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:selected_tags</span>])
1020:       <span class="ruby-keyword kw">end</span>
1021:     <span class="ruby-keyword kw">end</span>
1022: 
1023:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:language_id</span>]
1024:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">by_language</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:language_id</span>])
1025:     <span class="ruby-keyword kw">end</span>
1026:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:complete</span>]
1027:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:complete</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
1028:     <span class="ruby-keyword kw">end</span>
1029:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:collection</span>]
1030:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">in_collection</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:collection</span>])
1031:     <span class="ruby-keyword kw">else</span>
1032:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">SEARCH_RESULTS_MAX</span>)
1033:     <span class="ruby-keyword kw">end</span>
1034: 
1035:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span> <span class="ruby-operator">==</span> <span class="ruby-value">:false</span>
1036:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">unrestricted</span>
1037:     <span class="ruby-keyword kw">end</span>
1038: 
1039:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:sort_column</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;hit_count&quot;</span>
1040:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">select</span>(<span class="ruby-value str">&quot;works.*, hit_counters.hit_count AS hit_count&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-value">:hit_counter</span>)
1041:     <span class="ruby-keyword kw">end</span>
1042: 
1043:     <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">order</span>(<span class="ruby-identifier">sort_by</span>).<span class="ruby-identifier">posted</span>.<span class="ruby-identifier">unhidden</span>
1044:     <span class="ruby-comment cmt"># for now, trigger the lazy loading so we don't get an error on @works.size</span>
1045:     <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">compact</span>
1046: 
1047:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:user</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">ANONYMOUS_THRESHOLD_COUNT</span>
1048:       <span class="ruby-comment cmt"># strip out works hidden in challenges if on a user's specific page or if there are too few in this listing to conceal</span>
1049:       <span class="ruby-ivar">@works</span> = <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span> <span class="ruby-identifier">w</span>.<span class="ruby-identifier">unrevealed?</span>}
1050:     <span class="ruby-keyword kw">end</span>
1051: 
1052:     <span class="ruby-ivar">@filters</span> = <span class="ruby-identifier">build_filters</span>(<span class="ruby-ivar">@works</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">empty?</span>
1053: 
1054:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">page_args</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:total_entries</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@works</span>.<span class="ruby-identifier">size</span>)), <span class="ruby-ivar">@filters</span>, <span class="ruby-ivar">@pseuds</span>
1055:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="in-series-method" class="method-detail ">
				<a name="method-c-in_series"></a>

				<div class="method-heading">
				
					<span class="method-name">in_series</span><span
						class="method-args">(series)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="in-series-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 975</span>
975:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">in_series</span>(<span class="ruby-identifier">series</span>)
976:     <span class="ruby-identifier">joins</span>(<span class="ruby-value">:series</span>).
977:     <span class="ruby-identifier">where</span>(<span class="ruby-value str">&quot;series.id = ?&quot;</span>, <span class="ruby-identifier">series</span>.<span class="ruby-identifier">id</span>)
978:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="no-tags-method" class="method-detail ">
				<a name="method-c-no_tags"></a>

				<div class="method-heading">
				
					<span class="method-name">no_tags</span><span
						class="method-args">(tag_category, options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
returns an array, must come last TODO: if you know how to turn this into a
scope, please do! find all the works that do not have a tag in the given
category (i.e. no fandom, no characters etc.)
</p>
					

					
					<div class="method-source-code"
						id="no-tags-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 993</span>
993:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">no_tags</span>(<span class="ruby-identifier">tag_category</span>, <span class="ruby-identifier">options</span> = {})
994:     <span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tag_category</span>.<span class="ruby-identifier">tags</span>
995:     <span class="ruby-identifier">with_scope</span> <span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span> <span class="ruby-keyword kw">do</span>
996:       <span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>).<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span> <span class="ruby-identifier">w</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">w</span>.<span class="ruby-identifier">tags</span> &amp; <span class="ruby-identifier">tags</span>).<span class="ruby-identifier">empty?</span> }.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
997:     <span class="ruby-keyword kw">end</span>
998:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="purge-old-drafts-method" class="method-detail ">
				<a name="method-c-purge_old_drafts"></a>

				<div class="method-heading">
				
					<span class="method-name">purge_old_drafts</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="purge-old-drafts-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 189</span>
189:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">purge_old_drafts</span>
190:     <span class="ruby-identifier">draft_ids</span> = <span class="ruby-constant">Work</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value str">'works.posted = ? AND works.created_at &lt; ?'</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-value">1</span>.<span class="ruby-identifier">week</span>.<span class="ruby-identifier">ago</span>).<span class="ruby-identifier">value_of</span>(<span class="ruby-value">:id</span>)
191:     <span class="ruby-constant">Chapter</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:work_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">draft_ids</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value str">&quot;position DESC&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:destroy</span>)
192:     <span class="ruby-constant">Work</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">draft_ids</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:destroy</span>)
193:     <span class="ruby-identifier">draft_ids</span>.<span class="ruby-identifier">size</span>
194:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="visible-method" class="method-detail ">
				<a name="method-c-visible"></a>

				<div class="method-heading">
				
					<span class="method-name">visible</span><span
						class="method-args">(user=User.current_user)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Use the current user to determine what works are visible
</p>
					

					
					<div class="method-source-code"
						id="visible-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 906</span>
906:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">visible</span>(<span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>)
907:     <span class="ruby-identifier">visible_to_user</span>(<span class="ruby-identifier">user</span>)
908:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="visible-to-user-method" class="method-detail ">
				<a name="method-c-visible_to_user"></a>

				<div class="method-heading">
				
					<span class="method-name">visible_to_user</span><span
						class="method-args">(user=User.current_user)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
a complicated dynamic scope here: if the user is an <a
href="Admin.html">Admin</a>, we use the &#8220;visible_to_admin&#8220;
scope if the user is not a logged-in <a href="User.html">User</a>, we use
the &#8220;visible_to_all&#8220; scope otherwise, we use a join to get
userids and then get all posted works that are either unhidden OR belong to
this user. Note: in that last case we have to use select(&#8220;DISTINCT
works.&#8221;) because of cases where the same user appears twice on a
work.
</p>
					

					
					<div class="method-source-code"
						id="visible-to-user-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 891</span>
891:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">visible_to_user</span>(<span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>)
892:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>
893:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Admin'</span>
894:       <span class="ruby-identifier">visible_to_admin</span>
895:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'User'</span>
896:       <span class="ruby-identifier">select</span>(<span class="ruby-value str">&quot;DISTINCT works.*&quot;</span>).
897:       <span class="ruby-identifier">posted</span>.
898:       <span class="ruby-identifier">joins</span>({<span class="ruby-value">:pseuds</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user</span>}).
899:       <span class="ruby-identifier">where</span>(<span class="ruby-value str">&quot;works.hidden_by_admin = false OR users.id = ?&quot;</span>, <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>)
900:     <span class="ruby-keyword kw">else</span>
901:       <span class="ruby-identifier">visible_to_all</span>
902:     <span class="ruby-keyword kw">end</span>
903:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="--method" class="method-detail ">
				<a name="method-i-%3C%3D%3E"></a>

				<div class="method-heading">
				
					<span class="method-name">&lt;=&gt;</span><span
						class="method-args">(another_work)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
sort works by title
</p>
					

					
					<div class="method-source-code"
						id="--source">
<pre>
      <span class="ruby-comment cmt"># File app/models/work.rb, line 1093</span>
1093:   <span class="ruby-keyword kw">def</span> <span class="ruby-operator">&lt;=&gt;</span>(<span class="ruby-identifier">another_work</span>)
1094:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title_to_sort_on</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">another_work</span>.<span class="ruby-identifier">title_to_sort_on</span>
1095:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="add-filter-tagging-method" class="method-detail ">
				<a name="method-i-add_filter_tagging"></a>

				<div class="method-heading">
				
					<span class="method-name">add_filter_tagging</span><span
						class="method-args">(tag, meta=false)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Creates a filter_tagging relationship between the work and the tag or its
canonical synonym
</p>
					

					
					<div class="method-source-code"
						id="add-filter-tagging-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 663</span>
663:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_filter_tagging</span>(<span class="ruby-identifier">tag</span>, <span class="ruby-identifier">meta</span>=<span class="ruby-keyword kw">false</span>)
664:     <span class="ruby-identifier">admin_settings</span> = <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">cache</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value str">&quot;admin_settings&quot;</span>){<span class="ruby-constant">AdminSetting</span>.<span class="ruby-identifier">first</span>}
665:     <span class="ruby-identifier">filter</span> = <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">canonical?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">tag</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">merger</span>
666:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filter</span>
667:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filters</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">filter</span>)
668:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">meta</span>
669:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filter_taggings</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:filter_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:inherited</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
670:         <span class="ruby-keyword kw">else</span>
671:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filters</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">filter</span>
672:         <span class="ruby-keyword kw">end</span>
673:         <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">reset_filter_count</span>
674:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">meta</span>
675:         <span class="ruby-identifier">ft</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filter_taggings</span>.<span class="ruby-identifier">where</span>([<span class="ruby-value str">&quot;filter_id = ?&quot;</span>, <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">id</span>]).<span class="ruby-identifier">first</span>
676:         <span class="ruby-identifier">ft</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:inherited</span>, <span class="ruby-keyword kw">false</span>)
677:       <span class="ruby-keyword kw">end</span>
678:     <span class="ruby-keyword kw">end</span>
679:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="adjust-filter-counts-method" class="method-detail ">
				<a name="method-i-adjust_filter_counts"></a>

				<div class="method-heading">
				
					<span class="method-name">adjust_filter_counts</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Calls reset_filter_count on all the work&#8217;s filters
</p>
					

					
					<div class="method-source-code"
						id="adjust-filter-counts-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 723</span>
723:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">adjust_filter_counts</span>
724:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">should_reset_filters</span>
725:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filters</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">reset_filter_count</span> }
726:     <span class="ruby-keyword kw">end</span>
727:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
728:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="adjust-series-restriction-method" class="method-detail ">
				<a name="method-i-adjust_series_restriction"></a>

				<div class="method-heading">
				
					<span class="method-name">adjust_series_restriction</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Make sure the series restriction level is in line with its works
</p>
					

					
					<div class="method-source-code"
						id="adjust-series-restriction-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 426</span>
426:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">adjust_series_restriction</span>
427:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">blank?</span>
428:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">adjust_restricted</span> }
429:     <span class="ruby-keyword kw">end</span>
430:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="anonymous--method" class="method-detail ">
				<a name="method-i-anonymous%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">anonymous?</span><span
						class="method-args">(user=User.current_user)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="anonymous--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 350</span>
350:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">anonymous?</span>(<span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>)
351:     <span class="ruby-comment cmt"># here we check if the story is in a currently-anonymous challenge</span>
352:     <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">approved_collection_items</span>.<span class="ruby-identifier">anonymous</span>.<span class="ruby-identifier">empty?</span>
353:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="author-attributes--method" class="method-detail ">
				<a name="method-i-author_attributes%3D"></a>

				<div class="method-heading">
				
					<span class="method-name">author_attributes=</span><span
						class="method-args">(attributes)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Virtual attribute for pseuds
</p>
					

					
					<div class="method-source-code"
						id="author-attributes--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 234</span>
234:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">author_attributes=</span>(<span class="ruby-identifier">attributes</span>)
235:     <span class="ruby-identifier">selected_pseuds</span> = <span class="ruby-constant">Pseud</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">attributes</span>[<span class="ruby-value">:ids</span>])
236:     (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors</span> <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">selected_pseuds</span>
237:     <span class="ruby-comment cmt"># if current user has selected different pseuds</span>
238:     <span class="ruby-identifier">current_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>
239:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">User</span>
240:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors_to_remove</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">pseuds</span> &amp; (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">selected_pseuds</span>)
241:     <span class="ruby-keyword kw">end</span>
242:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Pseud</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">attributes</span>[<span class="ruby-value">:ambiguous_pseuds</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:ambiguous_pseuds</span>]
243:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attributes</span>[<span class="ruby-value">:byline</span>].<span class="ruby-identifier">blank?</span>
244:       <span class="ruby-identifier">results</span> = <span class="ruby-constant">Pseud</span>.<span class="ruby-identifier">parse_bylines</span>(<span class="ruby-identifier">attributes</span>[<span class="ruby-value">:byline</span>], <span class="ruby-value">:keep_ambiguous</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
245:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">results</span>[<span class="ruby-value">:pseuds</span>]
246:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">invalid_pseuds</span> = <span class="ruby-identifier">results</span>[<span class="ruby-value">:invalid_pseuds</span>]
247:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ambiguous_pseuds</span> = <span class="ruby-identifier">results</span>[<span class="ruby-value">:ambiguous_pseuds</span>]
248:     <span class="ruby-keyword kw">end</span>
249:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors</span>.<span class="ruby-identifier">flatten!</span>
250:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors</span>.<span class="ruby-identifier">uniq!</span>
251:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="challenge-assignment-ids-method" class="method-detail ">
				<a name="method-i-challenge_assignment_ids"></a>

				<div class="method-heading">
				
					<span class="method-name">challenge_assignment_ids</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="challenge-assignment-ids-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 297</span>
297:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">challenge_assignment_ids</span>
298:     <span class="ruby-identifier">challenge_assignments</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>)
299:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="challenge-assignment-ids--method" class="method-detail ">
				<a name="method-i-challenge_assignment_ids%3D"></a>

				<div class="method-heading">
				
					<span class="method-name">challenge_assignment_ids=</span><span
						class="method-args">(ids)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="challenge-assignment-ids--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 305</span>
305:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">challenge_assignment_ids=</span>(<span class="ruby-identifier">ids</span>)
306:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">challenge_assignments</span> = <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ChallengeAssignment</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>)}.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">assignment</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assignment</span>.<span class="ruby-identifier">offering_user</span> <span class="ruby-operator">==</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>}
307:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="challenge-claim-ids-method" class="method-detail ">
				<a name="method-i-challenge_claim_ids"></a>

				<div class="method-heading">
				
					<span class="method-name">challenge_claim_ids</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="challenge-claim-ids-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 301</span>
301:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">challenge_claim_ids</span>
302:     <span class="ruby-identifier">challenge_claims</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>)
303:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="change-ownership-method" class="method-detail ">
				<a name="method-i-change_ownership"></a>

				<div class="method-heading">
				
					<span class="method-name">change_ownership</span><span
						class="method-args">(old_user, new_user, new_pseud=nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Transfer ownership of the work from one user to another
</p>
					

					
					<div class="method-source-code"
						id="change-ownership-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 268</span>
268:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">change_ownership</span>(<span class="ruby-identifier">old_user</span>, <span class="ruby-identifier">new_user</span>, <span class="ruby-identifier">new_pseud</span>=<span class="ruby-keyword kw">nil</span>)
269:     <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;No new user provided, cannot change ownership&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">new_user</span>
270:     <span class="ruby-identifier">new_pseud</span> = <span class="ruby-identifier">new_user</span>.<span class="ruby-identifier">default_pseud</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_pseud</span>.<span class="ruby-identifier">nil?</span>
271:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_pseud</span>
272:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">chapter</span><span class="ruby-operator">|</span>
273:       <span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_pseud</span>
274:       <span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">save</span>
275:     <span class="ruby-keyword kw">end</span>
276:     <span class="ruby-identifier">save</span>
277:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">remove_author</span>(<span class="ruby-identifier">old_user</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">old_user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">users</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">old_user</span>)
278:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="chapter-attributes--method" class="method-detail ">
				<a name="method-i-chapter_attributes%3D"></a>

				<div class="method-heading">
				
					<span class="method-name">chapter_attributes=</span><span
						class="method-args">(attributes)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Virtual attribute for first chapter
</p>
					

					
					<div class="method-source-code"
						id="chapter-attributes--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 449</span>
449:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chapter_attributes=</span>(<span class="ruby-identifier">attributes</span>)
450:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">attributes</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">attributes</span>
451:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">posted</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">posted</span>
452:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="chapter-total-display-method" class="method-detail ">
				<a name="method-i-chapter_total_display"></a>

				<div class="method-heading">
				
					<span class="method-name">chapter_total_display</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
1/1, 2/3, 5/?, etc.
</p>
					

					
					<div class="method-source-code"
						id="chapter-total-display-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 537</span>
537:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chapter_total_display</span>
538:     <span class="ruby-identifier">current</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">posted?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">number_of_posted_chapters</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>
539:     <span class="ruby-identifier">current</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'/'</span> <span class="ruby-operator">+</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">wip_length</span>.<span class="ruby-identifier">to_s</span>
540:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="chaptered--method" class="method-detail ">
				<a name="method-i-chaptered%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">chaptered?</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns true if a work has or will have more than one chapter
</p>
					

					
					<div class="method-source-code"
						id="chaptered--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 509</span>
509:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chaptered?</span>
510:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">expected_number_of_chapters</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>
511:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="chapters-in-order-method" class="method-detail ">
				<a name="method-i-chapters_in_order"></a>

				<div class="method-heading">
				
					<span class="method-name">chapters_in_order</span><span
						class="method-args">(include_content = true)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="chapters-in-order-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 486</span>
486:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">chapters_in_order</span>(<span class="ruby-identifier">include_content</span> = <span class="ruby-keyword kw">true</span>)
487:     <span class="ruby-comment cmt"># in order</span>
488:     <span class="ruby-identifier">chapters</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value str">'position ASC'</span>)
489:     <span class="ruby-comment cmt"># only posted chapters unless author</span>
490:     <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Admin</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_author_of?</span>(<span class="ruby-keyword kw">self</span>))
491:       <span class="ruby-identifier">chapters</span> = <span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:posted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
492:     <span class="ruby-keyword kw">end</span>
493:     <span class="ruby-comment cmt"># when doing navigation pass false as contents are not needed</span>
494:     <span class="ruby-identifier">chapters</span> = <span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">select</span>(<span class="ruby-value str">'published_at, id, work_id, title, position, posted'</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">include_content</span>
495:     <span class="ruby-identifier">chapters</span>
496:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="check-filter-counts-method" class="method-detail ">
				<a name="method-i-check_filter_counts"></a>

				<div class="method-heading">
				
					<span class="method-name">check_filter_counts</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Determine if filter counts need to be reset after the work is saved
</p>
					

					
					<div class="method-source-code"
						id="check-filter-counts-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 708</span>
708:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_filter_counts</span>
709:     <span class="ruby-identifier">admin_settings</span> = <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">cache</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value str">&quot;admin_settings&quot;</span>){<span class="ruby-constant">AdminSetting</span>.<span class="ruby-identifier">first</span>}
710:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">should_reset_filters</span> = (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">visibility_changed?</span>)
711:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">admin_settings</span>.<span class="ruby-identifier">suspend_filter_counts?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">restricted_changed?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hidden_by_admin_changed?</span>)
712:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">should_reset_filters</span> = <span class="ruby-keyword kw">false</span>
713:     <span class="ruby-keyword kw">end</span>
714:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
715:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="check-for-invalid-chapters-method" class="method-detail ">
				<a name="method-i-check_for_invalid_chapters"></a>

				<div class="method-heading">
				
					<span class="method-name">check_for_invalid_chapters</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="check-for-invalid-chapters-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 159</span>
159:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_for_invalid_chapters</span>
160:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>[<span class="ruby-value">:chapters</span>].<span class="ruby-identifier">any?</span>
161:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-identifier">t</span>(<span class="ruby-value str">'chapter_invalid'</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Please enter your story in the text field below.&quot;</span>))
162:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:chapters</span>)
163:     <span class="ruby-keyword kw">end</span>
164:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="clean-and-validate-title-method" class="method-detail ">
				<a name="method-i-clean_and_validate_title"></a>

				<div class="method-heading">
				
					<span class="method-name">clean_and_validate_title</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="clean-and-validate-title-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 136</span>
136:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clean_and_validate_title</span>
137:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span>.<span class="ruby-identifier">blank?</span>
138:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span>.<span class="ruby-identifier">strip</span>
139:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">TITLE_MIN</span>
140:         <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Title must be at least %{min} characters long without leading spaces.&quot;</span>, <span class="ruby-value">:min</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">TITLE_MIN</span>))
141:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
142:       <span class="ruby-keyword kw">else</span>
143:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title_to_sort_on</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sorted_title</span>
144:       <span class="ruby-keyword kw">end</span>
145:     <span class="ruby-keyword kw">end</span>
146:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="comments-method" class="method-detail ">
				<a name="method-i-comments"></a>

				<div class="method-heading">
				
					<span class="method-name">comments</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
returns the top-level comments for all chapters in the work
</p>
					

					
					<div class="method-source-code"
						id="comments-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 750</span>
750:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">comments</span>
751:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">comments</span> }.<span class="ruby-identifier">flatten</span>
752:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="count-all-comments-method" class="method-detail ">
				<a name="method-i-count_all_comments"></a>

				<div class="method-heading">
				
					<span class="method-name">count_all_comments</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns number of comments Hidden and deleted comments are referenced in
the view because of the threading system - we don&#8217;t necessarily need
to hide their existence from other users
</p>
					

					
					<div class="method-source-code"
						id="count-all-comments-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 745</span>
745:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_all_comments</span>
746:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">count_all_comments</span> }.<span class="ruby-identifier">sum</span>
747:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="create-hit-counter-method" class="method-detail ">
				<a name="method-i-create_hit_counter"></a>

				<div class="method-heading">
				
					<span class="method-name">create_hit_counter</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="create-hit-counter-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 552</span>
552:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_hit_counter</span>
553:     <span class="ruby-identifier">counter</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build_hit_counter</span>
554:     <span class="ruby-identifier">counter</span>.<span class="ruby-identifier">save</span>
555:     <span class="ruby-identifier">$redis</span>.<span class="ruby-identifier">set</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">redis_key</span>(<span class="ruby-value">:hit_count</span>), <span class="ruby-value">0</span>)
556:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="database-hits-method" class="method-detail ">
				<a name="method-i-database_hits"></a>

				<div class="method-heading">
				
					<span class="method-name">database_hits</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="database-hits-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 625</span>
625:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">database_hits</span>
626:     <span class="ruby-identifier">db_hits</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hit_counter</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hit_counter</span>.<span class="ruby-identifier">hit_count</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
627:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">db_hits</span>
628:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="default-date-method" class="method-detail ">
				<a name="method-i-default_date"></a>

				<div class="method-heading">
				
					<span class="method-name">default_date</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="default-date-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 400</span>
400:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">default_date</span>
401:     <span class="ruby-identifier">backdate</span> = <span class="ruby-identifier">first_chapter</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:published_at</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">backdate</span>
402:     <span class="ruby-identifier">backdate</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
403:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="destroy-chapters-in-reverse-method" class="method-detail ">
				<a name="method-i-destroy_chapters_in_reverse"></a>

				<div class="method-heading">
				
					<span class="method-name">destroy_chapters_in_reverse</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="destroy-chapters-in-reverse-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 185</span>
185:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy_chapters_in_reverse</span>
186:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value str">&quot;position DESC&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:destroy</span>)
187:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="display-authors-method" class="method-detail ">
				<a name="method-i-display_authors"></a>

				<div class="method-heading">
				
					<span class="method-name">display_authors</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="display-authors-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 599</span>
599:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">display_authors</span>
600:     <span class="ruby-identifier">string</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">anonymous?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Anonymous&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:name</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">', '</span>)
601:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="download-authors-method" class="method-detail ">
				<a name="method-i-download_authors"></a>

				<div class="method-heading">
				
					<span class="method-name">download_authors</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
need the next two to be filesystem safe and not overly long
</p>
					

					
					<div class="method-source-code"
						id="download-authors-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 603</span>
603:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">download_authors</span>
604:     <span class="ruby-identifier">string</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">anonymous?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Anonymous&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:name</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">'-'</span>)
605:     <span class="ruby-identifier">string</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">conv</span>(<span class="ruby-value str">&quot;ASCII//TRANSLIT//IGNORE&quot;</span>, <span class="ruby-value str">&quot;UTF8&quot;</span>, <span class="ruby-identifier">string</span>)
606:     <span class="ruby-identifier">string</span> = <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[^[\w _-]]+/</span>, <span class="ruby-value str">''</span>)
607:     <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^(.{24}[\w.]*).*/</span>) {<span class="ruby-node">$1</span>}
608:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="download-basename-method" class="method-detail ">
				<a name="method-i-download_basename"></a>

				<div class="method-heading">
				
					<span class="method-name">download_basename</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="download-basename-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 615</span>
615:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">download_basename</span>
616:     <span class="ruby-node">&quot;#{self.download_dir}/#{self.download_title}&quot;</span>
617:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="download-dir-method" class="method-detail ">
				<a name="method-i-download_dir"></a>

				<div class="method-heading">
				
					<span class="method-name">download_dir</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="download-dir-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 591</span>
591:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">download_dir</span>
592:     <span class="ruby-node">&quot;#{Rails.public_path}/downloads/#{self.download_authors}/#{self.id}&quot;</span>
593:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="download-fandoms-method" class="method-detail ">
				<a name="method-i-download_fandoms"></a>

				<div class="method-heading">
				
					<span class="method-name">download_fandoms</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="download-fandoms-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 594</span>
594:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">download_fandoms</span>
595:     <span class="ruby-identifier">string</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;Multifandom&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fandoms</span>.<span class="ruby-identifier">string</span>
596:     <span class="ruby-identifier">string</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">conv</span>(<span class="ruby-value str">&quot;ASCII//TRANSLIT//IGNORE&quot;</span>, <span class="ruby-value str">&quot;UTF8&quot;</span>, <span class="ruby-identifier">string</span>)
597:     <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[^[\w _-]]+/</span>, <span class="ruby-value str">''</span>)
598:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="download-title-method" class="method-detail ">
				<a name="method-i-download_title"></a>

				<div class="method-heading">
				
					<span class="method-name">download_title</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="download-title-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 609</span>
609:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">download_title</span>
610:     <span class="ruby-identifier">string</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">conv</span>(<span class="ruby-value str">&quot;ASCII//TRANSLIT//IGNORE&quot;</span>, <span class="ruby-value str">&quot;UTF8&quot;</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span>)
611:     <span class="ruby-identifier">string</span> = <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[^[\w _-]]+/</span>, <span class="ruby-value str">''</span>)
612:     <span class="ruby-identifier">string</span> = <span class="ruby-value str">&quot;Work by &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">download_authors</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">blank?</span>
613:     <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/ +/</span>, <span class="ruby-value str">&quot; &quot;</span>).<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^(.{24}[\w.]*).*/</span>) {<span class="ruby-node">$1</span>}
614:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="ensure-revised-at-method" class="method-detail ">
				<a name="method-i-ensure_revised_at"></a>

				<div class="method-heading">
				
					<span class="method-name">ensure_revised_at</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Just to catch any cases that haven&#8217;t gone through <a
href="Work.html#method-i-set_revised_at">set_revised_at</a>
</p>
					

					
					<div class="method-source-code"
						id="ensure-revised-at-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 390</span>
390:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ensure_revised_at</span>
391:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span>.<span class="ruby-identifier">nil?</span>
392:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
393:     <span class="ruby-keyword kw">end</span>
394:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="find-all-comments-method" class="method-detail ">
				<a name="method-i-find_all_comments"></a>

				<div class="method-heading">
				
					<span class="method-name">find_all_comments</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Gets all comments for all chapters in the work
</p>
					

					
					<div class="method-source-code"
						id="find-all-comments-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 738</span>
738:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_all_comments</span>
739:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">find_all_comments</span> }.<span class="ruby-identifier">flatten</span>
740:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="first-chapter-method" class="method-detail ">
				<a name="method-i-first_chapter"></a>

				<div class="method-heading">
				
					<span class="method-name">first_chapter</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Gets the current first chapter
</p>
					

					
					<div class="method-source-code"
						id="first-chapter-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 499</span>
499:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">first_chapter</span>
500:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:first</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'position ASC'</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">first</span>
501:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="has-required-tags--method" class="method-detail ">
				<a name="method-i-has_required_tags%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">has_required_tags?</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Check to see that a work is tagged appropriately
</p>
					

					
					<div class="method-source-code"
						id="has-required-tags--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 651</span>
651:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_required_tags?</span>
652:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fandom_string</span>.<span class="ruby-identifier">blank?</span>
653:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">warning_string</span>.<span class="ruby-identifier">blank?</span>
654:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rating_string</span>.<span class="ruby-identifier">blank?</span>
655:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
656:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="hits-method" class="method-detail ">
				<a name="method-i-hits"></a>

				<div class="method-heading">
				
					<span class="method-name">hits</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="hits-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 619</span>
619:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hits</span>
620:     <span class="ruby-identifier">redis_hits</span> = <span class="ruby-identifier">$redis</span>.<span class="ruby-identifier">get</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">redis_key</span>(<span class="ruby-value">:hit_count</span>))
621:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">database_hits</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">redis_hits</span>
622:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">redis_hits</span>.<span class="ruby-identifier">to_i</span>
623:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="increment-hit-count-method" class="method-detail ">
				<a name="method-i-increment_hit_count"></a>

				<div class="method-heading">
				
					<span class="method-name">increment_hit_count</span><span
						class="method-args">(visitor)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
save hits
</p>
					

					
					<div class="method-source-code"
						id="increment-hit-count-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 559</span>
559:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">increment_hit_count</span>(<span class="ruby-identifier">visitor</span>)
560:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">last_visitor</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">visitor</span>
561:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">User</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_author_of?</span>(<span class="ruby-keyword kw">self</span>)
562:         <span class="ruby-identifier">$redis</span>.<span class="ruby-identifier">set</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">redis_key</span>(<span class="ruby-value">:hit_count</span>), <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">database_hits</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">$redis</span>.<span class="ruby-identifier">get</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">redis_key</span>(<span class="ruby-value">:hit_count</span>))
563:         <span class="ruby-identifier">$redis</span>.<span class="ruby-identifier">incr</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">redis_key</span>(<span class="ruby-value">:hit_count</span>))
564:         <span class="ruby-identifier">$redis</span>.<span class="ruby-identifier">set</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">redis_key</span>(<span class="ruby-value">:last_visitor</span>), <span class="ruby-identifier">visitor</span>)
565:         <span class="ruby-identifier">$redis</span>.<span class="ruby-identifier">sadd</span>(<span class="ruby-value str">&quot;Work:new_hits&quot;</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>)
566:       <span class="ruby-keyword kw">end</span>
567:     <span class="ruby-keyword kw">end</span>
568:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hits</span>
569:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="is-complete-method" class="method-detail ">
				<a name="method-i-is_complete"></a>

				<div class="method-heading">
				
					<span class="method-name">is_complete</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns true if a work is complete
</p>
					

					
					<div class="method-source-code"
						id="is-complete-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 532</span>
532:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_complete</span>
533:     <span class="ruby-keyword kw">return</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_wip</span>
534:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="is-wip-method" class="method-detail ">
				<a name="method-i-is_wip"></a>

				<div class="method-heading">
				
					<span class="method-name">is_wip</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns true if a work is not yet complete
</p>
					

					
					<div class="method-source-code"
						id="is-wip-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 527</span>
527:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_wip</span>
528:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">expected_number_of_chapters</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">expected_number_of_chapters</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">number_of_posted_chapters</span>
529:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="last-chapter-method" class="method-detail ">
				<a name="method-i-last_chapter"></a>

				<div class="method-heading">
				
					<span class="method-name">last_chapter</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Gets the current last chapter
</p>
					

					
					<div class="method-source-code"
						id="last-chapter-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 504</span>
504:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">last_chapter</span>
505:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:first</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'position DESC'</span>)
506:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="last-visitor-method" class="method-detail ">
				<a name="method-i-last_visitor"></a>

				<div class="method-heading">
				
					<span class="method-name">last_visitor</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
the last visitor is just used to decide whether or not to increment the hit
count so persisting it in the database is not critical
</p>
					

					
					<div class="method-source-code"
						id="last-visitor-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 573</span>
573:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">last_visitor</span>
574:     <span class="ruby-identifier">$redis</span>.<span class="ruby-identifier">get</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">redis_key</span>(<span class="ruby-value">:last_visitor</span>))
575:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="multipart--method" class="method-detail ">
				<a name="method-i-multipart%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">multipart?</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns true if a work has more than one chapter
</p>
					

					
					<div class="method-source-code"
						id="multipart--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 514</span>
514:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">multipart?</span>
515:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">number_of_chapters</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
516:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="number-of-chapters-method" class="method-detail ">
				<a name="method-i-number_of_chapters"></a>

				<div class="method-heading">
				
					<span class="method-name">number_of_chapters</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Get the total number of chapters for a work
</p>
					

					
					<div class="method-source-code"
						id="number-of-chapters-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 475</span>
475:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">number_of_chapters</span>
476:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">count</span>
477:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="number-of-posted-chapters-method" class="method-detail ">
				<a name="method-i-number_of_posted_chapters"></a>

				<div class="method-heading">
				
					<span class="method-name">number_of_posted_chapters</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Get the total number of posted chapters for a work Issue 1316: total number
needs to reflect the actual number of chapters posted rather than the total
number of chapters indicated by user
</p>
					

					
					<div class="method-source-code"
						id="number-of-posted-chapters-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 482</span>
482:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">number_of_posted_chapters</span>
483:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">posted</span>.<span class="ruby-identifier">count</span>
484:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="parent-attributes--method" class="method-detail ">
				<a name="method-i-parent_attributes%3D"></a>

				<div class="method-heading">
				
					<span class="method-name">parent_attributes=</span><span
						class="method-args">(attributes)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Virtual attribute for parent work, via related_works
</p>
					

					
					<div class="method-source-code"
						id="parent-attributes--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 767</span>
767:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parent_attributes=</span>(<span class="ruby-identifier">attributes</span>)
768:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:url</span>].<span class="ruby-identifier">blank?</span>
769:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:url</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-constant">ArchiveConfig</span>.<span class="ruby-constant">APP_URL</span>)
770:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:url</span>].<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/\/works\/(\d+)/</span>)
771:           <span class="ruby-keyword kw">begin</span>
772:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span> = {<span class="ruby-value">:parent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Work</span>.<span class="ruby-identifier">find</span>(<span class="ruby-node">$1</span>), <span class="ruby-value">:translation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:translation</span>]}
773:           <span class="ruby-keyword kw">rescue</span>
774:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;The work you listed as an inspiration does not seem to exist.&quot;</span>)
775:           <span class="ruby-keyword kw">end</span>
776:         <span class="ruby-keyword kw">else</span>
777:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Only a link to a work can be listed as an inspiration.&quot;</span>)
778:         <span class="ruby-keyword kw">end</span>
779:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:title</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:author</span>].<span class="ruby-identifier">blank?</span>
780:         <span class="ruby-identifier">error_message</span> = <span class="ruby-value str">&quot;&quot;</span>
781:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:title</span>].<span class="ruby-identifier">blank?</span>
782:           <span class="ruby-identifier">error_message</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;A parent work outside the archive needs to have a title. &quot;</span>
783:         <span class="ruby-keyword kw">end</span>
784:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:author</span>].<span class="ruby-identifier">blank?</span>
785:           <span class="ruby-identifier">error_message</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;A parent work outside the archive needs to have an author. &quot;</span>
786:         <span class="ruby-keyword kw">end</span>
787:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-identifier">error_message</span>)
788:       <span class="ruby-keyword kw">else</span>
789:         <span class="ruby-identifier">translation</span> = <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:translation</span>)
790:         <span class="ruby-identifier">ew</span> = <span class="ruby-constant">ExternalWork</span>.<span class="ruby-identifier">find_by_url</span>(<span class="ruby-identifier">attributes</span>[<span class="ruby-value">:url</span>])
791:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ew</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">ew</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:title</span>]) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">ew</span>.<span class="ruby-identifier">author</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:author</span>])
792:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span> = {<span class="ruby-value">:parent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ew</span>, <span class="ruby-value">:translation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">translation</span>}
793:         <span class="ruby-keyword kw">else</span>
794:           <span class="ruby-identifier">ew</span> = <span class="ruby-constant">ExternalWork</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">attributes</span>)
795:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ew</span>.<span class="ruby-identifier">save</span>
796:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span> = {<span class="ruby-value">:parent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ew</span>, <span class="ruby-value">:translation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">translation</span>}
797:           <span class="ruby-keyword kw">else</span>
798:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-value str">&quot;Parent work info would not save.&quot;</span>)
799:           <span class="ruby-keyword kw">end</span>
800:         <span class="ruby-keyword kw">end</span>
801:       <span class="ruby-keyword kw">end</span>
802:     <span class="ruby-keyword kw">end</span>
803:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="parents-method" class="method-detail ">
				<a name="method-i-parents"></a>

				<div class="method-heading">
				
					<span class="method-name">parents</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Works (internal or external) that this work was inspired by Can&#8217;t
make this a has_many association because it&#8217;s polymorphic
</p>
					

					
					<div class="method-source-code"
						id="parents-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 762</span>
762:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parents</span>
763:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent_work_relationships</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:parent</span>).<span class="ruby-identifier">compact</span>
764:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="post-first-chapter-method" class="method-detail ">
				<a name="method-i-post_first_chapter"></a>

				<div class="method-heading">
				
					<span class="method-name">post_first_chapter</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
If the work is posted, the first chapter should be posted too
</p>
					

					
					<div class="method-source-code"
						id="post-first-chapter-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 442</span>
442:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_first_chapter</span>
443:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">posted_changed?</span>
444:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">posted</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">posted</span>
445:     <span class="ruby-keyword kw">end</span>
446:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="published-at-method" class="method-detail ">
				<a name="method-i-published_at"></a>

				<div class="method-heading">
				
					<span class="method-name">published_at</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="published-at-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 396</span>
396:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">published_at</span>
397:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">first_chapter</span>.<span class="ruby-identifier">published_at</span>
398:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="recipients-method" class="method-detail ">
				<a name="method-i-recipients"></a>

				<div class="method-heading">
				
					<span class="method-name">recipients</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="recipients-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 322</span>
322:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">recipients</span>
323:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gifts</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:recipient</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,&quot;</span>)
324:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="recipients--method" class="method-detail ">
				<a name="method-i-recipients%3D"></a>

				<div class="method-heading">
				
					<span class="method-name">recipients=</span><span
						class="method-args">(recipient_names)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="recipients--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 309</span>
309:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">recipients=</span>(<span class="ruby-identifier">recipient_names</span>)
310:     <span class="ruby-identifier">new_gifts</span> = []
311:     <span class="ruby-identifier">recipient_names</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">','</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
312:       <span class="ruby-identifier">gift</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gifts</span>.<span class="ruby-identifier">for_name_or_byline</span>(<span class="ruby-identifier">name</span>.<span class="ruby-identifier">strip</span>).<span class="ruby-identifier">first</span>
313:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">gift</span>
314:         <span class="ruby-identifier">new_gifts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">gift</span>
315:       <span class="ruby-keyword kw">else</span>
316:         <span class="ruby-identifier">new_gifts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Gift</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:recipient</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">strip</span>)
317:       <span class="ruby-keyword kw">end</span>
318:     <span class="ruby-keyword kw">end</span>
319:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gifts</span> = <span class="ruby-identifier">new_gifts</span>
320:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="redis-key-method" class="method-detail ">
				<a name="method-i-redis_key"></a>

				<div class="method-heading">
				
					<span class="method-name">redis_key</span><span
						class="method-args">(sym)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
helper method to generate redis keys examples:
&#8220;work:2:hit_count&#8220;, &#8220;work:776:<a
href="Work.html#method-i-last_visitor">last_visitor</a>&#8220;
</p>
					

					
					<div class="method-source-code"
						id="redis-key-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 632</span>
632:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redis_key</span>(<span class="ruby-identifier">sym</span>)
633:     <span class="ruby-node">&quot;work:#{self.id}:#{sym}&quot;</span>
634:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="remove-author-method" class="method-detail ">
				<a name="method-i-remove_author"></a>

				<div class="method-heading">
				
					<span class="method-name">remove_author</span><span
						class="method-args">(author_to_remove)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="remove-author-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 253</span>
253:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_author</span>(<span class="ruby-identifier">author_to_remove</span>)
254:     <span class="ruby-identifier">pseuds_with_author_removed</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">author_to_remove</span>.<span class="ruby-identifier">pseuds</span>
255:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Exception</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Sorry, we can't remove all authors of a work.&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pseuds_with_author_removed</span>.<span class="ruby-identifier">empty?</span>
256:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span> = <span class="ruby-identifier">pseuds_with_author_removed</span>
257:     <span class="ruby-identifier">save</span>
258:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">chapter</span><span class="ruby-operator">|</span>
259:       <span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">pseuds</span> = (<span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">author_to_remove</span>.<span class="ruby-identifier">pseuds</span>).<span class="ruby-identifier">uniq</span>
260:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">empty?</span>
261:         <span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">pseuds</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span>
262:       <span class="ruby-keyword kw">end</span>
263:       <span class="ruby-identifier">chapter</span>.<span class="ruby-identifier">save</span>
264:     <span class="ruby-keyword kw">end</span>
265:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="remove-filter-tagging-method" class="method-detail ">
				<a name="method-i-remove_filter_tagging"></a>

				<div class="method-heading">
				
					<span class="method-name">remove_filter_tagging</span><span
						class="method-args">(tag)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Removes filter_tagging relationship unless the work is tagged with more
than one synonymous tags
</p>
					

					
					<div class="method-source-code"
						id="remove-filter-tagging-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 682</span>
682:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_filter_tagging</span>(<span class="ruby-identifier">tag</span>)
683:     <span class="ruby-identifier">filter</span> = <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">filter</span>
684:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filter</span>
685:       <span class="ruby-identifier">filters_to_remove</span> = [<span class="ruby-identifier">filter</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">meta_tags</span>
686:       <span class="ruby-identifier">filters_to_remove</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filter_to_remove</span><span class="ruby-operator">|</span>
687:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filters</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">filter_to_remove</span>)
688:           <span class="ruby-identifier">all_sub_tags</span> = <span class="ruby-identifier">filter_to_remove</span>.<span class="ruby-identifier">sub_tags</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">filter_to_remove</span>]
689:           <span class="ruby-identifier">sub_mergers</span> = <span class="ruby-identifier">all_sub_tags</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-identifier">all_sub_tags</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:mergers</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
690:           <span class="ruby-identifier">all_tags_with_filter_to_remove_as_meta</span> = <span class="ruby-identifier">all_sub_tags</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sub_mergers</span>
691:           <span class="ruby-identifier">remaining_tags</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tags</span> <span class="ruby-operator">-</span> [<span class="ruby-identifier">tag</span>]
692:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">remaining_tags</span> &amp; <span class="ruby-identifier">all_tags_with_filter_to_remove_as_meta</span>).<span class="ruby-identifier">empty?</span> <span class="ruby-comment cmt"># none of the remaining tags need filter_to_remove</span>
693:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filters</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">filter_to_remove</span>)
694:             <span class="ruby-identifier">filter_to_remove</span>.<span class="ruby-identifier">reset_filter_count</span>
695:           <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># we should keep filter_to_remove, but check if inheritence needs to be updated</span>
696:             <span class="ruby-identifier">direct_tags_for_filter_to_remove</span> = <span class="ruby-identifier">filter_to_remove</span>.<span class="ruby-identifier">mergers</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">filter_to_remove</span>]
697:             <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">remaining_tags</span> &amp; <span class="ruby-identifier">direct_tags_for_filter_to_remove</span>).<span class="ruby-identifier">empty?</span> <span class="ruby-comment cmt"># not tagged with filter or mergers directly</span>
698:               <span class="ruby-identifier">ft</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filter_taggings</span>.<span class="ruby-identifier">where</span>([<span class="ruby-value str">&quot;filter_id = ?&quot;</span>, <span class="ruby-identifier">filter_to_remove</span>.<span class="ruby-identifier">id</span>]).<span class="ruby-identifier">first</span>
699:               <span class="ruby-identifier">ft</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:inherited</span>, <span class="ruby-keyword kw">true</span>)
700:             <span class="ruby-keyword kw">end</span>
701:           <span class="ruby-keyword kw">end</span>
702:         <span class="ruby-keyword kw">end</span>
703:       <span class="ruby-keyword kw">end</span>
704:     <span class="ruby-keyword kw">end</span>
705:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="remove-outdated-downloads-method" class="method-detail ">
				<a name="method-i-remove_outdated_downloads"></a>

				<div class="method-heading">
				
					<span class="method-name">remove_outdated_downloads</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="remove-outdated-downloads-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 588</span>
588:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_outdated_downloads</span>
589:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">download_dir</span>)
590:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="reorder-method" class="method-detail ">
				<a name="method-i-reorder"></a>

				<div class="method-heading">
				
					<span class="method-name">reorder</span><span
						class="method-args">(positions)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Change the positions of the chapters in the work
</p>
					

					
					<div class="method-source-code"
						id="reorder-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 465</span>
465:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reorder</span>(<span class="ruby-identifier">positions</span>)
466:     <span class="ruby-constant">SortableList</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">posted</span>.<span class="ruby-identifier">in_order</span>).<span class="ruby-identifier">reorder_list</span>(<span class="ruby-identifier">positions</span>)
467:     <span class="ruby-comment cmt"># We're caching the chapter positions in the comment blurbs</span>
468:     <span class="ruby-comment cmt"># so we need to expire them</span>
469:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">empty?</span>
470:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">touch</span> }
471:     <span class="ruby-keyword kw">end</span>
472:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="save-chapters-method" class="method-detail ">
				<a name="method-i-save_chapters"></a>

				<div class="method-heading">
				
					<span class="method-name">save_chapters</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Save chapter data when the work is updated
</p>
					

					
					<div class="method-source-code"
						id="save-chapters-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 437</span>
437:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_chapters</span>
438:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">save</span>(<span class="ruby-value">:validate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>)
439:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="save-parents-method" class="method-detail ">
				<a name="method-i-save_parents"></a>

				<div class="method-heading">
				
					<span class="method-name">save_parents</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Save relationship to parent work if applicable
</p>
					

					
					<div class="method-source-code"
						id="save-parents-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 806</span>
806:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_parents</span>
807:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parents</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span>))
808:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span>[<span class="ruby-value">:parent</span>].<span class="ruby-identifier">blank?</span>
809:         <span class="ruby-identifier">relationship</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span>[<span class="ruby-value">:parent</span>].<span class="ruby-identifier">related_works</span>.<span class="ruby-identifier">build</span> <span class="ruby-value">:work_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:translation</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span>[<span class="ruby-value">:translation</span>]
810:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">relationship</span>.<span class="ruby-identifier">save</span>
811:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_parent</span> = <span class="ruby-keyword kw">nil</span>
812:         <span class="ruby-keyword kw">end</span>
813:       <span class="ruby-keyword kw">end</span>
814:     <span class="ruby-keyword kw">end</span>
815:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="series-attributes--method" class="method-detail ">
				<a name="method-i-series_attributes%3D"></a>

				<div class="method-heading">
				
					<span class="method-name">series_attributes=</span><span
						class="method-args">(attributes)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Virtual attribute for series
</p>
					

					
					<div class="method-source-code"
						id="series-attributes--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 410</span>
410:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">series_attributes=</span>(<span class="ruby-identifier">attributes</span>)
411:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attributes</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">blank?</span>
412:       <span class="ruby-identifier">old_series</span> = <span class="ruby-constant">Series</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">attributes</span>[<span class="ruby-value">:id</span>])
413:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">series</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">old_series</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">old_series</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">series</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">old_series</span>))
414:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">adjust_series_restriction</span>
415:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attributes</span>[<span class="ruby-value">:title</span>].<span class="ruby-identifier">blank?</span>
416:       <span class="ruby-identifier">new_series</span> = <span class="ruby-constant">Series</span>.<span class="ruby-identifier">new</span>
417:       <span class="ruby-identifier">new_series</span>.<span class="ruby-identifier">title</span> = <span class="ruby-identifier">attributes</span>[<span class="ruby-value">:title</span>]
418:       <span class="ruby-identifier">new_series</span>.<span class="ruby-identifier">restricted</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">restricted</span>
419:       <span class="ruby-identifier">new_series</span>.<span class="ruby-identifier">authors</span> = (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span> <span class="ruby-operator">+</span> (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors</span>)).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
420:       <span class="ruby-identifier">new_series</span>.<span class="ruby-identifier">save</span>
421:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">series</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_series</span>
422:     <span class="ruby-keyword kw">end</span>
423:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="set-challenge-claim-info-method" class="method-detail ">
				<a name="method-i-set_challenge_claim_info"></a>

				<div class="method-heading">
				
					<span class="method-name">set_challenge_claim_info</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="set-challenge-claim-info-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 288</span>
288:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_challenge_claim_info</span>
289:     <span class="ruby-comment cmt"># if this is fulfilling a challenge claim, add the collection and recipient</span>
290:     <span class="ruby-identifier">challenge_claims</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">assignment</span><span class="ruby-operator">|</span>
291:       <span class="ruby-identifier">add_to_collection</span>(<span class="ruby-identifier">claim</span>.<span class="ruby-identifier">collection</span>)
292:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gifts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Gift</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:pseud</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">claim</span>.<span class="ruby-identifier">requesting_pseud</span>) <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">recipients</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">recipients</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">claim</span>.<span class="ruby-identifier">request_byline</span>))
293:     <span class="ruby-keyword kw">end</span>
294:     <span class="ruby-identifier">save</span>
295:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="set-challenge-info-method" class="method-detail ">
				<a name="method-i-set_challenge_info"></a>

				<div class="method-heading">
				
					<span class="method-name">set_challenge_info</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="set-challenge-info-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 280</span>
280:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_challenge_info</span>
281:     <span class="ruby-comment cmt"># if this is fulfilling a challenge, add the collection and recipient</span>
282:     <span class="ruby-identifier">challenge_assignments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">assignment</span><span class="ruby-operator">|</span>
283:       <span class="ruby-identifier">add_to_collection</span>(<span class="ruby-identifier">assignment</span>.<span class="ruby-identifier">collection</span>)
284:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gifts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Gift</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:pseud</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">assignment</span>.<span class="ruby-identifier">requesting_pseud</span>) <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">recipients</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">recipients</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">assignment</span>.<span class="ruby-identifier">requesting_pseud</span>.<span class="ruby-identifier">byline</span>))
285:     <span class="ruby-keyword kw">end</span>
286:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="set-revised-at-method" class="method-detail ">
				<a name="method-i-set_revised_at"></a>

				<div class="method-heading">
				
					<span class="method-name">set_revised_at</span><span
						class="method-args">(date=nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="set-revised-at-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 370</span>
370:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_revised_at</span>(<span class="ruby-identifier">date</span>=<span class="ruby-keyword kw">nil</span>)
371:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">date</span> <span class="ruby-comment cmt"># if we pass a date, we want to set it to that (or current datetime if it's today)</span>
372:       <span class="ruby-identifier">date</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">value</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">value</span> = <span class="ruby-constant">DateTime</span><span class="ruby-operator">::</span><span class="ruby-identifier">jd</span>(<span class="ruby-identifier">date</span>.<span class="ruby-identifier">jd</span>, <span class="ruby-value">12</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>)
373:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span> = <span class="ruby-identifier">value</span>
374:     <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># we want to find the most recent @chapter.published_at date</span>
375:       <span class="ruby-identifier">recent_date</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-value str">'published_at'</span>)
376:       <span class="ruby-comment cmt"># if recent_date is today and revised_at is today, we don't want to update revised_at at all</span>
377:       <span class="ruby-comment cmt"># because we'd overwrite with an inaccurate time; if revised_at is not already today, best we can</span>
378:       <span class="ruby-comment cmt"># do is update with current time</span>
379:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">recent_date</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span>.<span class="ruby-identifier">to_date</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
380:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span>
381:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">recent_date</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span>.<span class="ruby-identifier">to_date</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
382:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
383:       <span class="ruby-keyword kw">else</span>
384:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">revised_at</span> = <span class="ruby-constant">DateTime</span><span class="ruby-operator">::</span><span class="ruby-identifier">jd</span>(<span class="ruby-identifier">recent_date</span>.<span class="ruby-identifier">jd</span>, <span class="ruby-value">12</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>)
385:       <span class="ruby-keyword kw">end</span>
386:     <span class="ruby-keyword kw">end</span>
387:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="set-word-count-method" class="method-detail ">
				<a name="method-i-set_word_count"></a>

				<div class="method-heading">
				
					<span class="method-name">set_word_count</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Set the value of word_count to reflect the length of the chapter content
</p>
					

					
					<div class="method-source-code"
						id="set-word-count-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 543</span>
543:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_word_count</span>
544:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_record?</span>
545:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">word_count</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">set_word_count</span>
546:     <span class="ruby-keyword kw">else</span>
547:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">word_count</span> = <span class="ruby-constant">Chapter</span>.<span class="ruby-identifier">select</span>(<span class="ruby-value str">&quot;SUM(word_count) AS work_word_count&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:work_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">work_word_count</span>
548:     <span class="ruby-keyword kw">end</span>
549:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="sorted-authors-method" class="method-detail ">
				<a name="method-i-sorted_authors"></a>

				<div class="method-heading">
				
					<span class="method-name">sorted_authors</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<pre>
                                                                      
</pre>
<p>
SORTING
</p>
<pre>
                                                                      </pre>
					

					
					<div class="method-source-code"
						id="sorted-authors-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/work.rb, line 1076</span>
1076:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sorted_authors</span>
1077:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:name</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,  &quot;</span>).<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^[\+-=_\?!'&quot;\.\/]/</span>, <span class="ruby-value str">''</span>)
1078:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="sorted-pseuds-method" class="method-detail ">
				<a name="method-i-sorted_pseuds"></a>

				<div class="method-heading">
				
					<span class="method-name">sorted_pseuds</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="sorted-pseuds-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/work.rb, line 1080</span>
1080:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sorted_pseuds</span>
1081:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:name</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;,  &quot;</span>).<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^[\+-=_\?!'&quot;\.\/]/</span>, <span class="ruby-value str">''</span>)
1082:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="sorted-title-method" class="method-detail ">
				<a name="method-i-sorted_title"></a>

				<div class="method-heading">
				
					<span class="method-name">sorted_title</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="sorted-title-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/work.rb, line 1084</span>
1084:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sorted_title</span>
1085:     <span class="ruby-identifier">sorted_title</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^[&quot;'\.\/]/</span>, <span class="ruby-value str">''</span>)
1086:     <span class="ruby-identifier">sorted_title</span> = <span class="ruby-identifier">sorted_title</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^(an?) (.*)/</span>, <span class="ruby-value str">'\2, \1'</span>)
1087:     <span class="ruby-identifier">sorted_title</span> = <span class="ruby-identifier">sorted_title</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^the (.*)/</span>, <span class="ruby-value str">'\1, the'</span>)
1088:     <span class="ruby-identifier">sorted_title</span> = <span class="ruby-identifier">sorted_title</span>.<span class="ruby-identifier">rjust</span>(<span class="ruby-value">5</span>, <span class="ruby-value str">&quot;0&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sorted_title</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/^\d/</span>)
1089:     <span class="ruby-identifier">sorted_title</span>
1090:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="tag-groups-method" class="method-detail ">
				<a name="method-i-tag_groups"></a>

				<div class="method-heading">
				
					<span class="method-name">tag_groups</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<pre>
                                                                     
</pre>
<p>
TAGGING Works are taggable objects.
</p>
<pre>
                                                                     </pre>
					

					
					<div class="method-source-code"
						id="tag-groups-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 642</span>
642:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tag_groups</span>
643:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">placeholder_tags</span>
644:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">placeholder_tags</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">group_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span> }
645:     <span class="ruby-keyword kw">else</span>
646:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">group_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span> }
647:     <span class="ruby-keyword kw">end</span>
648:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="unrevealed--method" class="method-detail ">
				<a name="method-i-unrevealed%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">unrevealed?</span><span
						class="method-args">(user=User.current_user)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="unrevealed--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 345</span>
345:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unrevealed?</span>(<span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>)
346:     <span class="ruby-comment cmt"># eventually here is where we check if it's in a challenge that hasn't been made public yet</span>
347:     <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">approved_collection_items</span>.<span class="ruby-identifier">unrevealed</span>.<span class="ruby-identifier">empty?</span>
348:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="update-complete-status-method" class="method-detail ">
				<a name="method-i-update_complete_status"></a>

				<div class="method-heading">
				
					<span class="method-name">update_complete_status</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="update-complete-status-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 519</span>
519:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_complete_status</span>
520:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">complete</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">posted</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">expected_number_of_chapters</span>
521:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">complete_changed?</span>
522:       <span class="ruby-constant">Work</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;complete = #{self.complete}&quot;</span>, <span class="ruby-node">&quot;id = #{self.id}&quot;</span>)
523:     <span class="ruby-keyword kw">end</span>
524:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="update-major-version-method" class="method-detail ">
				<a name="method-i-update_major_version"></a>

				<div class="method-heading">
				
					<span class="method-name">update_major_version</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
provide an interface to increment major version number resets minor_version
to 0
</p>
					

					
					<div class="method-source-code"
						id="update-major-version-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 361</span>
361:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_major_version</span>
362:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_attributes</span>({<span class="ruby-value">:major_version</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">major_version</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>, <span class="ruby-value">:minor_version</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>})
363:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="update-minor-version-method" class="method-detail ">
				<a name="method-i-update_minor_version"></a>

				<div class="method-heading">
				
					<span class="method-name">update_minor_version</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
provide an interface to increment minor version number
</p>
					

					
					<div class="method-source-code"
						id="update-minor-version-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 366</span>
366:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_minor_version</span>
367:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-value">:minor_version</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">minor_version</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)
368:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="validate-authors-method" class="method-detail ">
				<a name="method-i-validate_authors"></a>

				<div class="method-heading">
				
					<span class="method-name">validate_authors</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Checks that work has at least one author
</p>
					

					
					<div class="method-source-code"
						id="validate-authors-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 119</span>
119:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validate_authors</span>
120:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors</span>.<span class="ruby-identifier">blank?</span>
121:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">pseuds</span>.<span class="ruby-identifier">blank?</span>
122:         <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-identifier">t</span>(<span class="ruby-value str">'must_have_author'</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Work must have at least one author.&quot;</span>))
123:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
124:       <span class="ruby-keyword kw">else</span>
125:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors_to_sort_on</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sorted_pseuds</span>
126:       <span class="ruby-keyword kw">end</span>
127:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">invalid_pseuds</span>.<span class="ruby-identifier">blank?</span>
128:       <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-identifier">t</span>(<span class="ruby-value str">'invalid_pseuds'</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;These pseuds are invalid: %{pseuds}&quot;</span>, <span class="ruby-value">:pseuds</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">invalid_pseuds</span>.<span class="ruby-identifier">inspect</span>))
129:     <span class="ruby-keyword kw">else</span>
130:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">authors_to_sort_on</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sorted_authors</span>
131:     <span class="ruby-keyword kw">end</span>
132:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="validate-published-at-method" class="method-detail ">
				<a name="method-i-validate_published_at"></a>

				<div class="method-heading">
				
					<span class="method-name">validate_published_at</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="validate-published-at-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 148</span>
148:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validate_published_at</span>
149:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">first_chapter</span>.<span class="ruby-identifier">published_at</span>
150:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">first_chapter</span>.<span class="ruby-identifier">published_at</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
151:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">first_chapter</span>.<span class="ruby-identifier">published_at</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
152:       <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-identifier">t</span>(<span class="ruby-value str">'no_future_dating'</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Publication date can't be in the future.&quot;</span>))
153:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
154:     <span class="ruby-keyword kw">end</span>
155:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="visibility-changed--method" class="method-detail ">
				<a name="method-i-visibility_changed%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">visibility_changed?</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Must be called before save
</p>
					

					
					<div class="method-source-code"
						id="visibility-changed--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 718</span>
718:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">visibility_changed?</span>
719:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">posted_changed?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">restricted_changed?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hidden_by_admin_changed?</span>
720:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="visible-method" class="method-detail ">
				<a name="method-i-visible"></a>

				<div class="method-heading">
				
					<span class="method-name">visible</span><span
						class="method-args">(current_user=User.current_user)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<pre>
                                                                      
</pre>
<p>
VISIBILITY
</p>
<pre>
                                                                      </pre>
					

					
					<div class="method-source-code"
						id="visible-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 330</span>
330:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">visible</span>(<span class="ruby-identifier">current_user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>)
331:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_user</span> <span class="ruby-operator">==</span> <span class="ruby-value">:false</span>
332:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">posted</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">restricted</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hidden_by_admin</span>
333:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">posted</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hidden_by_admin</span>
334:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>
335:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hidden_by_admin?</span>
336:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Admin</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_author_of?</span>(<span class="ruby-keyword kw">self</span>)
337:     <span class="ruby-keyword kw">end</span>
338:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="visible--method" class="method-detail ">
				<a name="method-i-visible%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">visible?</span><span
						class="method-args">(user=User.current_user)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="visible--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 340</span>
340:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">visible?</span>(<span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">current_user</span>)
341:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">visible</span>(<span class="ruby-identifier">user</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span>
342:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="wip-length-method" class="method-detail ">
				<a name="method-i-wip_length"></a>

				<div class="method-heading">
				
					<span class="method-name">wip_length</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Virtual attribute for # of chapters
</p>
					

					
					<div class="method-source-code"
						id="wip-length-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 455</span>
455:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wip_length</span>
456:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">expected_number_of_chapters</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;?&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">expected_number_of_chapters</span>
457:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="wip-length--method" class="method-detail ">
				<a name="method-i-wip_length%3D"></a>

				<div class="method-heading">
				
					<span class="method-name">wip_length=</span><span
						class="method-args">(number)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="wip-length--source">
<pre>
     <span class="ruby-comment cmt"># File app/models/work.rb, line 459</span>
459:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wip_length=</span>(<span class="ruby-identifier">number</span>)
460:     <span class="ruby-identifier">number</span> = <span class="ruby-identifier">number</span>.<span class="ruby-identifier">to_i</span>
461:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">expected_number_of_chapters</span> = (<span class="ruby-identifier">number</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">number</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">chapters</span>.<span class="ruby-identifier">length</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">number</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
462:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="work-skin-allowed-method" class="method-detail ">
				<a name="method-i-work_skin_allowed"></a>

				<div class="method-heading">
				
					<span class="method-name">work_skin_allowed</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="work-skin-allowed-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/work.rb, line 72</span>
72:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">work_skin_allowed</span>
73:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">users</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_skin</span>.<span class="ruby-identifier">author</span>) <span class="ruby-operator">||</span> (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_skin</span>.<span class="ruby-identifier">public?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_skin</span>.<span class="ruby-identifier">official?</span>)
74:       <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:base</span>, <span class="ruby-identifier">ts</span>(<span class="ruby-value str">&quot;You do not have permission to use that custom work stylesheet.&quot;</span>))
75:     <span class="ruby-keyword kw">end</span>
76:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

